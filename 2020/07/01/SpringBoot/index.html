<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="generator" content="Hexo 4.2.1"><meta name="theme" content="hexo-theme-yun"><title>SpringBoot | Hexo</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;family=Source+Code+Pro&amp;display=swap" media="none" onload="this.media='all'"><script src="//at.alicdn.com/t/font_1140697_pem9yni52s.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link rel="shortcut icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"root":"/","title":"知识的海洋","version":"0.9.1","anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><meta name="description" content="第一章 SpringBoot基础了解Spring Boot项目结构spring boot 的基础结构分为三个文件目录: &amp;emsp;(1)src&#x2F;main&#x2F;java:入口(启动)类及程序的开发目录。在这个目录下进行业务开发、创建实体层、控制层、数据连接层等。 &amp;emsp;(2)src&#x2F;main&#x2F;resources:资源文件目录，主要用于存放静态文件和配置文件。 &amp;emsp;·static:用于存放">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot">
<meta property="og:url" content="https://1090266178.github.io/2020/07/01/SpringBoot/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="第一章 SpringBoot基础了解Spring Boot项目结构spring boot 的基础结构分为三个文件目录: &amp;emsp;(1)src&#x2F;main&#x2F;java:入口(启动)类及程序的开发目录。在这个目录下进行业务开发、创建实体层、控制层、数据连接层等。 &amp;emsp;(2)src&#x2F;main&#x2F;resources:资源文件目录，主要用于存放静态文件和配置文件。 &amp;emsp;·static:用于存放">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-07-01T11:17:48.000Z">
<meta property="article:modified_time" content="2020-07-15T06:19:39.365Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script defer src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="John Doe"><img width="96" loading="lazy" src="/img/touxiang.jpg" alt="John Doe"></a><div class="site-author-name"><a href="/about/">John Doe</a></div><a class="site-name" href="/about/site.html">Hexo</a><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">4</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">0</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">0</span></a></div><a class="site-state-item hty-icon-button" href="https://yun.yunyoujun.cn" target="_blank" rel="noopener" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=1090266178&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/YunYouJun" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://weibo.com/jizhideyunyoujun" title="微博" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.douban.com/people/yunyoujun/" title="豆瓣" target="_blank" style="color:#007722"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-douban-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=247102977" title="网易云音乐" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/people/yunyoujun/" title="知乎" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/1579790" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/YunYouJun" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://t.me/elpsycn" title="Telegram Channel" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:me@yunyoujun.cn" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://travellings.now.sh/" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-send-plane-2-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#第一章-SpringBoot基础"><span class="toc-number">1.</span> <span class="toc-text">第一章 SpringBoot基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#了解Spring-Boot项目结构"><span class="toc-number">1.1.</span> <span class="toc-text">了解Spring Boot项目结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#了解就SpringBoot的入口类"><span class="toc-number">1.2.</span> <span class="toc-text">了解就SpringBoot的入口类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#了解SpringBoot的自动配置"><span class="toc-number">1.3.</span> <span class="toc-text">了解SpringBoot的自动配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#什么时注解式编程"><span class="toc-number">1.4.</span> <span class="toc-text">什么时注解式编程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#了解系统注解"><span class="toc-number">1.5.</span> <span class="toc-text">了解系统注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RestController"><span class="toc-number">1.5.1.</span> <span class="toc-text">@RestController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean"><span class="toc-number">1.5.2.</span> <span class="toc-text">@Bean</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#maven打包指令"><span class="toc-number">1.5.3.</span> <span class="toc-text">maven打包指令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第二章基础配置"><span class="toc-number">2.</span> <span class="toc-text">第二章基础配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#不使用spring-boot-starter-parent"><span class="toc-number">2.1.</span> <span class="toc-text">不使用spring-boot-starter-parent</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#emsp-depndencyManagement项目版本控制器"><span class="toc-number">2.1.1.</span> <span class="toc-text">&amp;emsp;depndencyManagement项目版本控制器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringBootApplication"><span class="toc-number">2.1.2.</span> <span class="toc-text">@SpringBootApplication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EnableAutoConfiguration"><span class="toc-number">2.1.3.</span> <span class="toc-text">@EnableAutoConfiguration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ComponentScant"><span class="toc-number">2.1.4.</span> <span class="toc-text">@ComponentScant</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#关闭banner"><span class="toc-number">2.1.5.</span> <span class="toc-text">关闭banner</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tomcat配置"><span class="toc-number">2.2.</span> <span class="toc-text">Tomcat配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jetty配置"><span class="toc-number">2.3.</span> <span class="toc-text">Jetty配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Undertow配置"><span class="toc-number">2.4.</span> <span class="toc-text">Undertow配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Properties配置"><span class="toc-number">2.5.</span> <span class="toc-text">Properties配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTPS配置"><span class="toc-number">2.6.</span> <span class="toc-text">HTTPS配置</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#SpringBoot不支持同时再配置中启动HTTP和HTTPS-这时候可以配置请求重定向，将HTTP请求重定向为HTTPS请求。配置方式如下"><span class="toc-number">2.6.0.0.0.1.</span> <span class="toc-text">SpringBoot不支持同时再配置中启动HTTP和HTTPS.这时候可以配置请求重定向，将HTTP请求重定向为HTTPS请求。配置方式如下:</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#类型安全配置属性"><span class="toc-number">2.7.</span> <span class="toc-text">类型安全配置属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#YAML配置"><span class="toc-number">2.8.</span> <span class="toc-text">YAML配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用配置文件"><span class="toc-number">2.9.</span> <span class="toc-text">使用配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#YAML语法"><span class="toc-number">2.10.</span> <span class="toc-text">YAML语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#yaml详解"><span class="toc-number">2.10.1.</span> <span class="toc-text">yaml详解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Profile-properties和yml配置多环境"><span class="toc-number">2.11.</span> <span class="toc-text">Profile   properties和yml配置多环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用cmd指令-进行外部配置properties时会覆盖内部默认properties配置"><span class="toc-number">2.12.</span> <span class="toc-text">使用cmd指令 进行外部配置properties时会覆盖内部默认properties配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第3章SpringBoot整合视图技术"><span class="toc-number">3.</span> <span class="toc-text">第3章SpringBoot整合视图技术</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#本章概要"><span class="toc-number">3.0.0.0.1.</span> <span class="toc-text">本章概要</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#emsp-整合Thymeleaf"><span class="toc-number">3.1.</span> <span class="toc-text">&amp;emsp;整合Thymeleaf</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#emsp-2-配置Thymeleaf"><span class="toc-number">3.1.0.1.</span> <span class="toc-text">&amp;emsp;2.配置Thymeleaf</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#emsp-整合FreeMarker"><span class="toc-number">3.2.</span> <span class="toc-text">&amp;emsp;整合FreeMarker</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#emsp-2-配置FreeMarker"><span class="toc-number">3.2.1.</span> <span class="toc-text">&amp;emsp;2.配置FreeMarker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据库配置"><span class="toc-number">3.2.2.</span> <span class="toc-text">数据库配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第四章-SpringBoot整合Web开发"><span class="toc-number">4.</span> <span class="toc-text">第四章 SpringBoot整合Web开发</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#返回JSON数据"><span class="toc-number">5.</span> <span class="toc-text">返回JSON数据</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#默认实现"><span class="toc-number">5.1.</span> <span class="toc-text">默认实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean-1"><span class="toc-number">5.1.1.</span> <span class="toc-text">@Bean</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义转换器"><span class="toc-number">5.1.2.</span> <span class="toc-text">自定义转换器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#emsp-1-使用Gson"><span class="toc-number">5.1.2.1.</span> <span class="toc-text">&amp;emsp;1.使用Gson</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-使用fastjson"><span class="toc-number">5.1.2.2.</span> <span class="toc-text">2.使用fastjson</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#静态资源访问"><span class="toc-number">5.2.</span> <span class="toc-text">静态资源访问</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#默认策略"><span class="toc-number">5.2.1.</span> <span class="toc-text">默认策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义策略"><span class="toc-number">5.2.2.</span> <span class="toc-text">自定义策略</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#emsp-1-在配置文件中定义"><span class="toc-number">5.2.2.0.0.1.</span> <span class="toc-text">&amp;emsp;1.在配置文件中定义</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#emsp-emsp-2-Java编码定义"><span class="toc-number">5.2.2.0.0.2.</span> <span class="toc-text">&amp;emsp;&amp;emsp;2.Java编码定义</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文件上传"><span class="toc-number">5.3.</span> <span class="toc-text">文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#单文件上传"><span class="toc-number">5.3.1.</span> <span class="toc-text">单文件上传</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多文件上传"><span class="toc-number">5.3.2.</span> <span class="toc-text">多文件上传</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ControllerAdvice"><span class="toc-number">5.4.</span> <span class="toc-text">@ControllerAdvice</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#全局异常处理"><span class="toc-number">5.4.0.1.</span> <span class="toc-text">全局异常处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加全局数据"><span class="toc-number">5.4.0.2.</span> <span class="toc-text">添加全局数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#请求参数预处理"><span class="toc-number">5.4.0.3.</span> <span class="toc-text">请求参数预处理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义错误项"><span class="toc-number">5.5.</span> <span class="toc-text">自定义错误项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#简单配置"><span class="toc-number">5.5.1.</span> <span class="toc-text">简单配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#复杂配置"><span class="toc-number">5.5.2.</span> <span class="toc-text">复杂配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#emsp-1-自定义Error数据"><span class="toc-number">5.5.2.1.</span> <span class="toc-text">&amp;emsp;1.自定义Error数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-自定义Error视图"><span class="toc-number">5.5.2.2.</span> <span class="toc-text">2.自定义Error视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-完全自定义"><span class="toc-number">5.5.2.3.</span> <span class="toc-text">3.完全自定义</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#同源策略"><span class="toc-number">5.6.</span> <span class="toc-text">同源策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CORS支持"><span class="toc-number">5.7.</span> <span class="toc-text">CORS支持</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#emsp-1-创建SpringBoot工程"><span class="toc-number">5.7.0.1.</span> <span class="toc-text">&amp;emsp;1.创建SpringBoot工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#emsp-2-创建控制器"><span class="toc-number">5.7.0.2.</span> <span class="toc-text">&amp;emsp;2.创建控制器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置类与XML配置"><span class="toc-number">5.8.</span> <span class="toc-text">配置类与XML配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注册拦截器"><span class="toc-number">5.9.</span> <span class="toc-text">注册拦截器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动系统任务"><span class="toc-number">5.10.</span> <span class="toc-text">启动系统任务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CommandLineRunner"><span class="toc-number">5.10.1.</span> <span class="toc-text">CommandLineRunner</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://1090266178.github.io/2020/07/01/SpringBoot/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="John Doe"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Hexo"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">SpringBoot</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2020-07-01 19:17:48" itemprop="dateCreated datePublished" datetime="2020-07-01T19:17:48+08:00">2020-07-01</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="修改时间：2020-07-15 14:19:39" itemprop="dateModified" datetime="2020-07-15T14:19:39+08:00">2020-07-15</time></div><div class="post-classify"></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content post-markdown"><h1 id="第一章-SpringBoot基础"><a href="#第一章-SpringBoot基础" class="headerlink" title="第一章 SpringBoot基础"></a>第一章 SpringBoot基础</h1><h2 id="了解Spring-Boot项目结构"><a href="#了解Spring-Boot项目结构" class="headerlink" title="了解Spring Boot项目结构"></a>了解Spring Boot项目结构</h2><p>spring boot 的基础结构分为三个文件目录:</p>
<p>&emsp;(1)src/main/java:入口(启动)类及程序的开发目录。在这个目录下进行业务开发、创建实体层、控制层、数据连接层等。</p>
<p>&emsp;(2)src/main/resources:资源文件目录，主要用于存放静态文件和配置文件。</p>
<p>&emsp;·static:用于存放静态资源，如层叠样式表CSS(Cascading Style Sheets)文件、JavaScript文件、图片等。</p>
<p>&emsp;·templates:用于存放模板文件。</p>
<p>&emsp;·application.properties:用于配置项目运行所需的配置数据。如果用YAML方式管理配置，则YAML文件也放在这个目录中。</p>
<p>&emsp;·src/test/java:测试程序所在的目录</p>
<p>&emsp;在创建工程时，如果什么依赖都不选择(在新版本中必须要选择一项)，则spring boot也会在pom.xml文件中加入以下依赖模块。</p>
<p>&emsp;·核心模块spring-boot-starter:用于支持自动配置、日志和YAML.</p>
<p>&emsp;·测试模块spring-boot-starter-test：包括JUnit、Hamcrest和Mockito，用于测试。</p>
<h2 id="了解就SpringBoot的入口类"><a href="#了解就SpringBoot的入口类" class="headerlink" title="了解就SpringBoot的入口类"></a>了解就SpringBoot的入口类</h2><p>&emsp;在创建SpringBoot项目时，会自动创建一个用于启动的、名为“项目名+Application”的入口类、他是项目的启动入口。在IDEA中打开入口类之后，可以单机类或“main”方法左侧的三角形按钮，通过弹出的选项来运行或调试SpringBoot应用程序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.Controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@org</span>.springframework.stereotype.Controller</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hellp</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"helloword3"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;从上述代码中可以看到，默认会加上注解@SpringBottApplication,以标注这是SpringBoot项目的入口类。</p>
<p>&emsp;入口类中有一个”main”方法，其中使用了SpringApplication的静态“run”方法，并将”HelloWorldApplication”类和”main”方法的参数”args”传递了进去,以启动”HelloWorldApplication”类。</p>
<h2 id="了解SpringBoot的自动配置"><a href="#了解SpringBoot的自动配置" class="headerlink" title="了解SpringBoot的自动配置"></a>了解SpringBoot的自动配置</h2><p>&emsp;SpringBoot会根据配置的依赖信息进行自动配置，从而减轻开发者搭建环境和配置的负担。如果在项目中依赖了spring-boot-starter-web，则Springboot会自动配置Web环境(配置Tomcat、WebMVC、Validator、JSON等)。</p>
<p>&emsp;springboot自动配置是是通过注解@EnableAutoConfiguration来实现的，具有非入侵性。如果要查看当前有哪些自动配置，则可以使用下方的“debug”调试命令：</p>
<figure class="highlight"><figcaption><span>-jar *.jar -debug```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&amp;emsp;如果在IDEA中进行开发，则可以单机“run→EditConfigurations”命令，在弹出的窗口中设置“Program arguments”参数为“--debug”。在启动应用程序之后，在控制台中即可看到条件评估报告(CONDITIONS EVALUATION REPORT)。</span><br><span class="line"></span><br><span class="line">&amp;emsp;如果不需要某些自动配置，则可以通过注解<span class="meta">@EnableAutoConfiguration</span>的“exclude”或excludeName属性来指定，或在配置(application.properties或application.yml)中指定<span class="string">"spring.autoconfigure.exclude"</span>的值。</span><br><span class="line"></span><br><span class="line">### 了解SpringBoot热部署</span><br><span class="line"></span><br><span class="line">&amp;emsp;springBoot 热部署是为了更好的支持调试，在项目进行修改之后不需要耗费时间重启，在应用程序运行的情况下即可实时生效，以节约时间和操作。要实现热部署，则需要添加下方热部署的依赖</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line"></span><br><span class="line">&lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">&lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line"></span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>&emsp;改依赖在项目打包时会被禁用。如果用“java -jar”命令启动应用程序，或使用一个特定的classloader启动应用程序，则Spring Boot会认为这是一个“生成环境”，所以不会运行。如果项目中使用了Redis作为缓存，则请禁止使用热部署，以免出现类型转换等问题。</p>
<p>​    </p>
<h2 id="什么时注解式编程"><a href="#什么时注解式编程" class="headerlink" title="什么时注解式编程"></a>什么时注解式编程</h2><p>&emsp;注解用来定义一个类、属性或一些方法，以便程序能被编译处理。它相当于一个说明文件，告诉应用程序某个被注解的类或属性时什么，要怎么处理。注解可以用于标注报、类、方法和变量等。</p>
<h2 id="了解系统注解"><a href="#了解系统注解" class="headerlink" title="了解系统注解"></a>了解系统注解</h2><table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>@Override</td>
<td>用于修饰方法，表示此方法重写了父类方法</td>
</tr>
<tr>
<td>@Deprecated</td>
<td>用于修饰方法，表示此方法已经过时。经常在版本升级后会遇到</td>
</tr>
<tr>
<td>@SuppressWarnnings</td>
<td>告诉编译器忽视某类编译警告</td>
</tr>
</tbody></table>
<p>重点接收下@SuppressWarnnings注解。他有以下几种属性。</p>
<p>·unchecked：未检查的转化。</p>
<p>·unused：未使用的变量。</p>
<p>·resource：泛型，即为指定类型。</p>
<p>·path：在类中的路径。原文件路径中有不存在的路径。</p>
<p>·deprecation：使用了某些不赞成使用的类和方法。</p>
<p>·fallthrough:switch语句执行到顶，不会遇到break关键字。</p>
<p>·serial：实现了Serializable，但未定义serialVersionUID。</p>
<p>·rawtypes：没有传递带有泛型的参数。</p>
<p>·all：代表全部类型的警告。</p>
<h3 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a>@RestController</h3><p>&emsp;它用户返回JSON、xml等数据，但不能返回HTML页面。相当于注解@ResponseBody和注解@Controller合在一起的作用。</p>
<h3 id="Bean"><a href="#Bean" class="headerlink" title="@Bean"></a>@Bean</h3><p>&emsp;它代表产生一个Bean，并交给Spring管理。用于封装数据，一般有Setter、Getter方法。在MVC模型中，对应的时M(模型)。</p>
<h3 id="maven打包指令"><a href="#maven打包指令" class="headerlink" title="maven打包指令"></a>maven打包指令</h3><h1 id="第二章基础配置"><a href="#第二章基础配置" class="headerlink" title="第二章基础配置"></a>第二章基础配置</h1><h2 id="不使用spring-boot-starter-parent"><a href="#不使用spring-boot-starter-parent" class="headerlink" title="不使用spring-boot-starter-parent"></a>不使用spring-boot-starter-parent</h2><h3 id="emsp-depndencyManagement项目版本控制器"><a href="#emsp-depndencyManagement项目版本控制器" class="headerlink" title="&emsp;depndencyManagement项目版本控制器"></a>&emsp;depndencyManagement项目版本控制器</h3><p>&emsp;如下代码添加进pom文件,注释掉spring-boot-parent使用如下代码管理依赖的版本号，注意由于注释掉spring-boot-parent 要重新配置plugin的java的版本、编码等格式 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">configuration</span>&gt;</span> <span class="comment">&lt;!--这里的1.8指的时使用javaJDK1.8编译项目--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h3><p>&emsp;SpringBootApplication实际上时一个组合注解，定义如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(</span><br><span class="line">    excludeFilters = &#123;<span class="meta">@Filter</span>(</span><br><span class="line">    type = FilterType.CUSTOM,</span><br><span class="line">    classes = &#123;TypeExcludeFilter<span class="class">.<span class="keyword">class</span>&#125;</span></span><br><span class="line"><span class="class">), @<span class="title">Filter</span>(</span></span><br><span class="line"><span class="class">    <span class="title">type</span> </span>= FilterType.CUSTOM,</span><br><span class="line">    classes = &#123;AutoConfigurationExcludeFilter<span class="class">.<span class="keyword">class</span>&#125;</span></span><br><span class="line"><span class="class">)&#125;</span></span><br><span class="line"><span class="class">)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">SpringBootApplication</span> </span>&#123;</span><br><span class="line">    <span class="comment">//略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;这个注解有三个注解组成。</p>
<p>​    1.第一个@SpringBootConfiguration的定义如下:</p>
<p>&emsp;原来就是一个@Configuration，所以@SpringBootConfiguration的功能就是表明这是一个配置类，开发者可以在这个类中配置Bean。从这个角度来讲，这个类所扮演的角色有点类似于Spring中applicationCOntext.xml文件的角色。</p>
<p>&emsp;2.第二个注解@EnableAutoConfiguration表示开启自动化配置。SpringBoot中的自动化配置时非浸入式的，在任何时刻，开发者都可以使用自定义配置代替自动化配置中的某一个配置。</p>
<p>&emsp;3.第三个注解@ComponentScan完成包扫描，也是Spring中的功能。由于@ComponentScan注解默认扫描的类都位于当前类所在包的下面，因此建议在实际项目开发中把项目启动类放在根包中。</p>
<p>&emsp;虽然项目的启动类也包含＠Configuration 注解，但是开发者可以创建一个新的类专门用来配置Bean ，这样便于配置 管理。这 类只需要 上＠Configuration 注解即可，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Myconfig</span></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;项目启动类中的@ComponentScan注解，除了扫描@Service、@Repository、@Component、@Controller和@RestController等之外，也会扫描@Configuration注解的类。</p>
<h3 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h3><p>&emsp;@EnableAutoConfiguration 注解表示开启自动化配直 由于项目中 加了 spring-boot-starterweb 依赖 因此在开启了自动化配置之后会自动进行 Spring 和SpringMVC 的配置<br>&emsp;在Java 项目的 main 方法中，通过 SpringApplication 中的 run方法启动项目。第一个参数传入App.class ，告诉 Spring 哪个是主要组件。第二个参数是运行时输入的其他参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String [] args)</span> </span>&#123; </span><br><span class="line">    SpringApplication.run (App<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ComponentScant"><a href="#ComponentScant" class="headerlink" title="@ComponentScant"></a>@ComponentScant</h3><p>&emsp;在控制器中提供了一个“/hello ”接口，此时需要配置包扫描才能将 Hello Controller 注册到 SpringMVC容器中，因此在 App 类上面再添加一个注解＠ omponentScan 进行包扫描，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String [] args)</span> </span>&#123; </span><br><span class="line">    SpringApplication.run (App<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    &emsp;扫描的位置为helloApplication这个类当前目录及其子目录的类也可根据参数改变扫描位置</p>
<p>&emsp;也可以直接使用组合注解＠Spring BootApplication 来代替@EnableAutoConfiguration和@ComponentScan 代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String [] args)</span> </span>&#123; </span><br><span class="line">    SpringApplication.run (App<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="关闭banner"><a href="#关闭banner" class="headerlink" title="关闭banner"></a>关闭banner</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> st a t ic <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String [] args)</span> </span>&#123; </span><br><span class="line">    SpringApplicationBuilder bulder = <span class="keyword">new</span> </span><br><span class="line">    SpringApplicationBuilder(Chapter012Application . <span class="class"><span class="keyword">class</span>) </span>; </span><br><span class="line">    builder.bannerMode(Banner.Mode.OFF).run(args) ; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;通过SpringApplicationBuilder来这只bannerMode为OFF，这样启动时banner就消失了。</p>
<h2 id="Tomcat配置"><a href="#Tomcat配置" class="headerlink" title="Tomcat配置"></a>Tomcat配置</h2><p>&emsp;1. 常规配置</p>
<p>&emsp;在SpringBoot项目中，可以内置Tomcat、Jetty、Undertow、Netty等容器。当开发者添加了spring-boot-starter-web依赖之后，默认会使用Tomcat作为Web容器。如果需要对Tomcat做进一步配置，可以在application.properties中配置代码如下:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8089</span></span><br><span class="line"><span class="meta">server.error.path</span>=<span class="string">/error</span></span><br><span class="line"><span class="meta">server.servlet.session.timeout</span>=<span class="string">30m</span></span><br><span class="line"><span class="meta">server.servlet.context-path</span>=<span class="string">/chapter02</span></span><br><span class="line"><span class="meta">server.tomcat.uri-encoding</span>=<span class="string">utf-8</span></span><br><span class="line"><span class="meta">server.tomcat.max-threads</span>=<span class="string">500</span></span><br><span class="line"><span class="meta">server.tomcat.basedir</span>=<span class="string">/home/sang/tmp</span></span><br></pre></td></tr></table></figure>

<p>代码解释:</p>
<p>·server.port配置了Web容器的端口号。</p>
<p>·error.path配置了当项目出错时跳转取的也秒。</p>
<p>·session.timeout配置了session失效时间，30m表示30分钟，如果不写单位，默认单位时秒。由于Tomcat中配置session过期时间以分钟为单位，因此这里单位如果时秒的话，该时间会被转换为一个不超过所配置秒数的最大分钟数，例如这里配置了119，默认单位为秒，则实际session过期时间为1分钟。</p>
<p>·context-path表示项目名称，不配置时默认为/。如果配置了，就要在访问路劲中加上配置的路径。</p>
<p>·uri-encoding表示配置Tomcat请求编码。</p>
<p>·max-threads表示Tomcat最大线程数。</p>
<p>·basedir时一个存放Tomcat运行日志和临时文件的目录，若不配置，则默认使用系统的临时目录。</p>
<p>&emsp;2.HTTPS配置</p>
<p>&emsp;由于HTTPS具有良好的安全性，在开发中得到了越来越广泛的应用，想微信公众号、小程序等的开发都使用HTTPS来完成。对于个人开发者而言，一个HTTPS证书的价格还是有点贵，国内有一些云服务器厂商提供免费的HTTPS证书，一个账号可以申请数个。不过在jdk中提供了一个Java数字证书管理工具keytool，在\jak\bin目录下，通过这个工具可以自己生成一个数字证书，生成命令如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -genkey -alias tomcathttps -keyalg RSA -keysize 2048 -keystore sang.p12 -validity 365</span><br></pre></td></tr></table></figure>

<p>命令解释:</p>
<p>· -genkey表示要创建一个新的密钥。</p>
<p>· -alias表示keystore的别名。</p>
<p>· -keyalg表示使用的加密算法时RSA,一种非对称加密算法。</p>
<p>· -keysize表示密钥的长度。</p>
<p>· -keystore表示生成的密钥存放位置。</p>
<p>· -validity表示密钥的有效时间，单位为天。</p>
<p>&emsp;在cmd窗口中直接执行如上命令，在执行过程中需要输入密钥口令等信息，根据提示输入即可。命令执行完成后，会在当前用户目录下生成一个名为sang.p12的文件，将这个文件复制到项目的根目录下，然后再application.properties中做如下配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.ssl.key-store&#x3D;sang.p12</span><br><span class="line">server.ssl.key-alias&#x3D;tomcathttps</span><br><span class="line">server.ssl.key-store-password&#x3D;123456</span><br></pre></td></tr></table></figure>

<p>代码解释：</p>
<p>· key-store表示密钥文件名。</p>
<p>· key-alias表示密钥别名。</p>
<p>· key-store-password就是在cmd命令执行过程输入的密码。</p>
<p>&emsp;配置成功后，启动项目，在浏览器中输入“<a href="https://localhost:808" target="_blank" rel="noopener">https://localhost:808</a> chapter02/hello。” 来查看结果。注意，证书是自己生成的，不被浏览器认可，此时添加信任或者继续前进即可.</p>
<p>&emsp;此时如以HTTP的方式访问接口，就会访问失败，这是因为springBoot不支持同时在配置中启动HTTP和HTTPS。这个时候可以配置请求重定向，将HTTP请求重定向为HTTPS请求。配置方式如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.Context;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.connector.Connector;</span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.util.descriptor.web.SecurityCollection;</span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.util.descriptor.web.SecurityConstraint;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TomcatConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">TomcatServletWebServerFactory <span class="title">tomcatServletWebServerFactory</span><span class="params">()</span></span>&#123;</span><br><span class="line">        TomcatServletWebServerFactory factory= <span class="keyword">new</span> TomcatServletWebServerFactory()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span>  <span class="keyword">void</span> <span class="title">postProcessContext</span><span class="params">(Context context)</span></span>&#123;</span><br><span class="line">                SecurityConstraint constraint =<span class="keyword">new</span> SecurityConstraint();</span><br><span class="line">                constraint.setUserConstraint(<span class="string">"CONFIDENTIAL"</span>);</span><br><span class="line">                SecurityCollection collection = <span class="keyword">new</span> SecurityCollection();</span><br><span class="line">                collection.addPattern(<span class="string">"/*"</span>);</span><br><span class="line">                constraint.addCollection(collection);</span><br><span class="line">                context.addConstraint(constraint);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        factory.addAdditionalTomcatConnectors(createTomcatConnector());</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> Connector <span class="title">createTomcatConnector</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Connector connector = <span class="keyword">new</span> Connector(<span class="string">"org.apache.coyote.http11.Http11NioProtocol"</span>);</span><br><span class="line">        connector.setScheme(<span class="string">"http"</span>);</span><br><span class="line">        connector.setPort(<span class="number">8080</span>);       <span class="comment">//url输入http的8080端口 只能是http请求</span></span><br><span class="line">        connector.setSecure(<span class="keyword">false</span>);</span><br><span class="line">        connector.setRedirectPort(<span class="number">8089</span>);    <span class="comment">//重定向进入到https的8089端口</span></span><br><span class="line">        <span class="keyword">return</span> connector;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>&emsp;这里首先配置一个TomcatServletWebServerFactory，然后添加一个Tomcat中的Connector(监听8080端口)，并将请求转发到8089上去。</p>
<p>&emsp;配置完成后，在浏览器中输入“<a href="http://localhost:8080/chapter02/hello”,就会自动重定向到https://localhost:8089/chapter02/hello上。" target="_blank" rel="noopener">http://localhost:8080/chapter02/hello”,就会自动重定向到https://localhost:8089/chapter02/hello上。</a></p>
<h2 id="Jetty配置"><a href="#Jetty配置" class="headerlink" title="Jetty配置"></a>Jetty配置</h2><p>&amp;除了Tomcat外，也可以在SpringBoot中嵌入Jetty,配置方式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;exclusions&gt;</span><br><span class="line">	&lt;exclusion&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-tomcat&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;&#x2F;exclusion&gt;</span><br><span class="line">	&lt;&#x2F;exclusions&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-jetty&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>主要是从spring-boot-starter-web中除去默认的Tomcat，然后加入Jetty的依赖即可。此时启动项目及，查看启动日志。</p>
<h2 id="Undertow配置"><a href="#Undertow配置" class="headerlink" title="Undertow配置"></a>Undertow配置</h2><p>&emsp;Undertow是一个红帽公司开源的Java服务器，具有非常号的性能，在SpringBoot中也得到了很好的支持，配置方式与Jetty类似，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;exclusions&gt;</span><br><span class="line">		&lt;exclusion&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-tomcat&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;&#x2F;exclusion&gt;</span><br><span class="line">	&lt;&#x2F;exclusions&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-undertow&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>&emsp;启动后查看日志</p>
<h2 id="Properties配置"><a href="#Properties配置" class="headerlink" title="Properties配置"></a>Properties配置</h2><p>&emsp;SpringBoot中采用了大量的自动化配置，但是对开发者而言，在实际项目中不可避免会有一些需要自己手动配置，承载这些自定义配置的文件就是resources目录下的application.properties文件(也可以使用YAML配置来替代application.preperties配置)。</p>
<p>SpringBoot项目中的application。properties配置文件一共可以出现在如下4个位置:</p>
<p>·  项目根目录下的config文件夹中。</p>
<p>· 项目根目录下。</p>
<p>· classpath下的config文件夹中。</p>
<p>· classpath下。</p>
<p>&emsp;如果者4个位置中都有application.properties文件，那么加载的优先级从1到4依次降低，互补模式：相同的部分取优先级高的 不相同的部分互相补充。</p>
<p>&emsp;如果开发着在开发中为使用application.properties,而是使用了application.yml作为配置文件，那么配置文件的优先级和properties文件的一致。</p>
<p>&emsp;默认情况下，SpringBoot按照1-4的顺序依次查找application.properties并加载.如果开发者不想使用application.properties作为配置文件名，也可以自己定义。例如,在resources目录下创建一个配置文件app.properties,然后将项目打成jar包，打包成功后，使用如下命令运行:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar demo-<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>-SNAPSHOT.jar --spring.config.name=app</span><br></pre></td></tr></table></figure>

<p>&emsp;在运行时再指定配置文件的名字。使用spring.config.location可以指定配置文件所在目录(注意需要以/结束)，代码如下：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar demo-<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>-SNAPSHOT.jar --spring.config.name=app</span><br></pre></td></tr></table></figure>

<h2 id="HTTPS配置"><a href="#HTTPS配置" class="headerlink" title="HTTPS配置"></a>HTTPS配置</h2><p>&emsp;由于HTTPS具有良好的安全性，在开发得到了越来越广泛的应用，在jdk中提供了一个Java数字证书管理工具keytool，在\jdk\bin目录下，通过这个工具可以自己生成一个数字证书,生成命令如下:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytoll -genkey -alias tomcathttps -keyalg RSA -keysize <span class="number">2048</span> -keystore sang.p12 -validity <span class="number">365</span></span><br></pre></td></tr></table></figure>

<p>命令解释:</p>
<p>· -genkey表示要创建一个新的密钥。</p>
<p>· -alias表示keystore的别名。</p>
<p>· -keyalg表示使用的加密算法时RSA，一种非对称加密算法。</p>
<p>· -keysize表示密钥的长度。</p>
<p>· -keystore表示生成的密钥存放位置。</p>
<p>· -validity 表示密钥的有效时间，单位为天。</p>
<p>&emsp;在cmd窗口中直接执行如上命令，在执行的过程中需要输入密钥口令等信息，根据提示输入即可。命令执行完成后，会在当前用户目录下生成一个名为sang.p12的文件，将这个文件复制到项目的根目录下，然后再application.properties中做如下配置:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.ssl.key-store</span>=<span class="string">sang.p12</span></span><br><span class="line"><span class="meta">server.ssl.key-alias</span>=<span class="string">tomcathttps</span></span><br><span class="line"><span class="meta">server.ssl.key-store-parssword</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure>

<p>代码解释：</p>
<p>· key-store表示密钥文件名。</p>
<p>· key-alias表示密钥别名。</p>
<p>· key-store-password就是再cmd命令执行过程中输入的密码。</p>
<p>&emsp;配置成功后，启动项目，再浏览器中输入”<a href="https://localhost:8081/chapter02/hello&quot;来查看结果。注意证书时自己生成的，不被浏览器认可，次数添加信息或者继续前进即可。" target="_blank" rel="noopener">https://localhost:8081/chapter02/hello&quot;来查看结果。注意证书时自己生成的，不被浏览器认可，次数添加信息或者继续前进即可。</a></p>
<h6 id="SpringBoot不支持同时再配置中启动HTTP和HTTPS-这时候可以配置请求重定向，将HTTP请求重定向为HTTPS请求。配置方式如下"><a href="#SpringBoot不支持同时再配置中启动HTTP和HTTPS-这时候可以配置请求重定向，将HTTP请求重定向为HTTPS请求。配置方式如下" class="headerlink" title="SpringBoot不支持同时再配置中启动HTTP和HTTPS.这时候可以配置请求重定向，将HTTP请求重定向为HTTPS请求。配置方式如下:"></a>SpringBoot不支持同时再配置中启动HTTP和HTTPS.这时候可以配置请求重定向，将HTTP请求重定向为HTTPS请求。配置方式如下:</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.Context;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.connector.Connector;</span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.util.descriptor.web.SecurityCollection;</span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.util.descriptor.web.SecurityConstraint;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TomcatConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">TomcatServletWebServerFactory <span class="title">tomcatServletWebServerFactory</span><span class="params">()</span></span>&#123;</span><br><span class="line">        TomcatServletWebServerFactory factory= <span class="keyword">new</span> TomcatServletWebServerFactory()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span>  <span class="keyword">void</span> <span class="title">postProcessContext</span><span class="params">(Context context)</span></span>&#123;</span><br><span class="line">                SecurityConstraint constraint =<span class="keyword">new</span> SecurityConstraint();</span><br><span class="line">                constraint.setUserConstraint(<span class="string">"CONFIDENTIAL"</span>);</span><br><span class="line">                SecurityCollection collection = <span class="keyword">new</span> SecurityCollection();</span><br><span class="line">                collection.addPattern(<span class="string">"/*"</span>);</span><br><span class="line">                constraint.addCollection(collection);</span><br><span class="line">                context.addConstraint(constraint);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        factory.addAdditionalTomcatConnectors(createTomcatConnector());</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> Connector <span class="title">createTomcatConnector</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Connector connector = <span class="keyword">new</span> Connector(<span class="string">"org.apache.coyote.http11.Http11NioProtocol"</span>);</span><br><span class="line">        connector.setScheme(<span class="string">"http"</span>);</span><br><span class="line">        connector.setPort(<span class="number">8080</span>);       <span class="comment">//url输入http的8080端口 只能是http请求</span></span><br><span class="line">        connector.setSecure(<span class="keyword">false</span>);</span><br><span class="line">        connector.setRedirectPort(<span class="number">8081</span>);    <span class="comment">//重定向进入到https的8089端口</span></span><br><span class="line">        <span class="keyword">return</span> connector;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;这里首先配置一个TomcatServletWebServerFactory,然后添加一个Tomcat中的Connector(监听8080端口)，并将请求转发到8081上去。</p>
<p>&emsp;配置完成后,再浏览器中输入”<a href="http://localhost:8080/chapter02/hello&quot;,就会自动重定向到https://localhost:8081/chapter02/hello上。" target="_blank" rel="noopener">http://localhost:8080/chapter02/hello&quot;,就会自动重定向到https://localhost:8081/chapter02/hello上。</a></p>
<h2 id="类型安全配置属性"><a href="#类型安全配置属性" class="headerlink" title="类型安全配置属性"></a>类型安全配置属性</h2><p>&emsp;无论时Properties配置还是YAML配置，最终都会被加载到Spring Environment中。Spring提供了@Value注解以及EnvironmentAware接口来将Spring Environment中的数据注入到属性上，Spring Boot对此进一步提出了类型安全配置属性(Type-safe Configuration Properties),这样即使再数据量非常庞大的情况下，也可以更加方便地将配置文件中的数据注入Bean中。考虑再application.properties中添加如下一段配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pro.name&#x3D;你哈</span><br><span class="line">pro.age&#x3D;12</span><br></pre></td></tr></table></figure>

<p>&emsp;将这一段配置数据注入如下Bean中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"pro"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pro</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Pro&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码解释：</p>
<p>· @ConfigurationProperties中的prefix属性描述了要加载的配置文件的前缀。</p>
<p>· 如果配置文件时一个YAML文件，那么可以将数据注入一个集合中。</p>
<p>· Spring boot采用了一种宽松的规则来进行属性绑定，如果Bean中的属性名为authorName,那么配置文件中的属性可以时pro.author_name、pro.author-name、pro.authorName或者pro.AUTHORNAME。</p>
<h2 id="YAML配置"><a href="#YAML配置" class="headerlink" title="YAML配置"></a>YAML配置</h2><p>&emsp;YAML时JSON的超集，简洁而强大，时一种专门用来书写配置文件的语言，可以替代application.properties。再创建一个SpringBoot项目时，引入的spring-boot-starter-web</p>
<p>依赖间接地引入了snakeyaml依赖，snakeyaml会实现对YAML配置的解析。YAML的使用非常简单，利用缩进来表示层级关系，并且大小写敏感。再SpringBOot项目中使用YAML只需要再resources目录下创建一个application.yml文件即可，然后向application.yml中添加如下配置:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">	<span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">	<span class="attr">servlet:</span></span><br><span class="line">		<span class="attr">context-path:</span> <span class="string">/chapter02</span></span><br><span class="line">	<span class="attr">tomcat:</span></span><br><span class="line">	 	<span class="attr">uri-encoding:</span> <span class="string">utf-8</span></span><br></pre></td></tr></table></figure>

<p>&emsp;这段配置等效于application.properties中的如下配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.port&#x3D;8089</span><br><span class="line">server.servlet.context-path&#x3D;&#x2F;chapter02</span><br><span class="line">server.tomcat.uri-encoding&#x3D;utf-8</span><br></pre></td></tr></table></figure>

<p>&emsp;此时可以将resources目录下的application.properties文件删除，完全使用YAML完成文件的配置。也可以两个都存在properties优先级更高。</p>
<h2 id="使用配置文件"><a href="#使用配置文件" class="headerlink" title="使用配置文件"></a>使用配置文件</h2><p>&emsp;SpringBoot支持使用Properties和YAML两种配置方式。两者功能类似，都能完成SpringBoot的配置，但是Properties的优先级要高于YAML（YAML语言的文件以”.yml”为后缀）。</p>
<p>&emsp;YAML文件的好处时——它采用的时树状结构,一目了然。但是，使用YAML配置方式时要注意以下几点。</p>
<p>·原来以“.“分隔的key会变成树状结构。例如，“server.prot=8080”会变成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">	port:8080</span><br></pre></td></tr></table></figure>

<p>·在key后的冒号后一定要跟一个空格，如”port:8080“.</p>
<p>·如果把原有的application.properties删除，则建议执行一下”maven -X clean install“命令。</p>
<p>·YAML格式不支持用注解@PropertySource导入配置。</p>
<h2 id="YAML语法"><a href="#YAML语法" class="headerlink" title="YAML语法"></a>YAML语法</h2><p>1、YAML基本语法</p>
<p>-使用缩进表示层级关系</p>
<p>-缩进时不允许使用Tab键，只允许使用空格。</p>
<p>-缩进的空格数目不重要，只要相同层级的元素左侧对齐即可</p>
<p>-大小写敏感</p>
<p>2、YAML支持的三种数据结构</p>
<p>-对象：键值对的集合</p>
<p>-数组：一组按次序排列的只</p>
<p>-字面量：单个的、不可再分的值</p>
<h3 id="yaml详解"><a href="#yaml详解" class="headerlink" title="yaml详解"></a>yaml详解</h3><p>1、基本语法</p>
<p>&emsp;k:(空格)v 表示一对键值对(空格必须有);</p>
<p>&emsp;以空格的缩进来控制层级关系；只要时做对齐的一列数据，都是同一个层级的.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">	port: 8080</span><br><span class="line">	path: &#x2F;hello</span><br></pre></td></tr></table></figure>

<p>&emsp;属性和值也是大小写敏感；</p>
<p>2、值的写法</p>
<p>字面量: 普通的值（数字，字符串，布尔）</p>
<p>&emsp;k: v : 字面直接来写；</p>
<p>&emsp;&emsp;字符串默认不用加上单引号或者双引号；</p>
<p>&emsp;&emsp;””    双引号：不会转义字符串里面的特殊字符；特殊字符会作为本身想表示的意思</p>
<p>&emsp;&emsp;&emsp;name: “zhangsan \n lisi”  输出 zhangsan 换行 lisi</p>
<p>&emsp;&emsp;’’    单引号；会转移特殊字符，特殊字符最终只是一个普通的字符串数据</p>
<p>&emsp;&emsp;&emsp;name: ‘zhangsan \n lisi’ 输出 zhangsan \n lisi</p>
<p>对象、Map(属性和值)(键值对):</p>
<p>&emsp;k: v   在下一行来写对象的属性和值的关系；注意缩进</p>
<p>&emsp;&emsp;对象还是k: v的方式</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">friends:</span></span><br><span class="line">	<span class="attr">lastName:</span> <span class="string">zhangsan</span></span><br><span class="line">	<span class="attr">age:</span> <span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>行内写法</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">friends:</span> <span class="string">&#123;lastName:</span> <span class="string">zhangsan,age:</span> <span class="number">18</span><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>



<p>数组(List,Set):</p>
<p>用- 值表示数组中的一个元素</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pets:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line"> <span class="string">-dog</span></span><br><span class="line"> <span class="string">-pig</span></span><br></pre></td></tr></table></figure>

<p>行内写法</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pets:</span> <span class="string">[cat,dog,pig]</span></span><br></pre></td></tr></table></figure>

<h2 id="Profile-properties和yml配置多环境"><a href="#Profile-properties和yml配置多环境" class="headerlink" title="Profile   properties和yml配置多环境"></a>Profile   properties和yml配置多环境</h2><p>&emsp;开发者再项目发布之前，一般需要频繁地在开法环境、测试环境以及生产环境之间进行切换这个时候大量地配置需要频繁更改，例如数据库配置、redis配置、mongodb配置、jms配置等。频繁修改带来了巨大地工作量，Spring对此提供了解决方案(@Profile注解),SpringBoot则更进一步提供了更加简洁地解决方案，Springboot中约定地不同环境下配置文件名称规则为application-{profile}.properties,profile占位符表示当前环境地名称，具体配置步骤如下:</p>
<p>&emsp;1.创建配置文件</p>
<p>&emsp;首先在resources目录下创建两个配置文件:application-dev.properties和application-prod.properties,费别表示开发环境中地配置和生成环境中地配置。其中，application-dev.properties文件地内容如下:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8080</span></span><br></pre></td></tr></table></figure>

<p>application-prod.properties文件地内容如下:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">80</span></span><br></pre></td></tr></table></figure>

<p>这里为了简化问题并且容易看到效果</p>
<p>，两个配置文件中主要修改了以下项目端口号。</p>
<p>&emsp;2.配置application.properties</p>
<p>&emsp;然后再application.properties中进行配置:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.profiles.active</span>=<span class="string">dev</span></span><br></pre></td></tr></table></figure>

<p>这个表示使用application-dev.properties配置文件启动项目，若将dev改为prod,则表示使用application-prod.properties启动项目。项目启动成功后，就可以通过相应地端口进行访问了。</p>
<p>//若application.properties中也设置了端口号 则会被覆盖 dev或prod文件的优先级高于application文件，即使用他俩设置的端口号</p>
<p>&emsp;3.再代码中配置</p>
<p>&emsp;对于第二步再application.properties中添加地配置，我们也可以再代码中添加配置来完成，再启动类地main方法上添加如下代码，可以替换第二步地配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SpringApplicationBUilder builder = <span class="keyword">new</span> SpringApplicationBuilder(Chapter013Application<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">builder.application().setAdditionalProfiles(<span class="string">"prod"</span>);</span><br><span class="line">builder.run(args);</span><br></pre></td></tr></table></figure>

<p>&emsp;4.项目启动时配置</p>
<p>&emsp;对于第2步和第3步提到的两种配置方式，也可以再将项目打成jar包后启动时，在命令行动态指定当前环境，示例命令如下:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar demo-<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>-SNAPSHOT.jar --spring.profiles.active=prod</span><br></pre></td></tr></table></figure>



<h2 id="使用cmd指令-进行外部配置properties时会覆盖内部默认properties配置"><a href="#使用cmd指令-进行外部配置properties时会覆盖内部默认properties配置" class="headerlink" title="使用cmd指令 进行外部配置properties时会覆盖内部默认properties配置"></a>使用cmd指令 进行外部配置properties时会覆盖内部默认properties配置</h2><p>&emsp;使用如下指令指定外部properties文件会把内部配置的properties文件覆盖</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar demo-<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>-SNAPSHOT.jar --spring.config.location=D:/app.properties</span><br></pre></td></tr></table></figure>



<h1 id="第3章SpringBoot整合视图技术"><a href="#第3章SpringBoot整合视图技术" class="headerlink" title="第3章SpringBoot整合视图技术"></a>第3章SpringBoot整合视图技术</h1><h5 id="本章概要"><a href="#本章概要" class="headerlink" title="本章概要"></a>本章概要</h5><p>&emsp;· 整合Thymeleaf</p>
<p>&emsp;· 整合FreeMarker</p>
<p>&emsp;在目前的企业级应用开发中，前后端分离是趋势，但是视图层技术还占有一席之地。SpringBoot对视图层技术提供了很好的支持，官方推荐使用的模板引擎是Thymeleaf,不过想FreeMarker也支持，JSP技术在这里并步推荐使用。</p>
<h2 id="emsp-整合Thymeleaf"><a href="#emsp-整合Thymeleaf" class="headerlink" title="&emsp;整合Thymeleaf"></a>&emsp;整合Thymeleaf</h2><p>&emsp;Thymeleaf是新一代Java模板引擎，类似于Velocity、FreeMarker等传统Java模板引擎。与传统Java模板引擎不同的是，Thymeleaf支持HTMl原型，既可以让前端工程师在浏览器中直接打开查看样式，也可以让后端工程师结合真是数据查看显示效果。同时，Springboot提供了Thymeleaf自动化配置解决方案，因此在SpringBoot中使用Thymeleaf非常方便。SpringBoot整合Thymeleaf主要可通过如下步骤:</p>
<p>&emsp;1.创建工程，添加依赖</p>
<p>&emsp;新建一个SpringBoot工程，然后添加spring-boot-starter-web和spring-boot-starter-thymeleaf依赖，代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springFramework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="emsp-2-配置Thymeleaf"><a href="#emsp-2-配置Thymeleaf" class="headerlink" title="&emsp;2.配置Thymeleaf"></a>&emsp;2.配置Thymeleaf</h4><p>&emsp;Springboot为Thymeleaf提供了自动化配置类ThymeleafAutoConfiguration,相关的配置属性在ThymeleafProperties类中，ThymeleafProperties部分源码如下:    //这里的代码是Thymeleaf依赖提供的类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"spring.thymeleaf"</span>) </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThymeleafProperties</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_ENCODING = StandardCharsets.UTF_8;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PREFIX = <span class="string">"classpath:/templates/"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SUFFIX = <span class="string">".html"</span>;</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;由此配置可以看到，默认的模板位置在classpath:/templates/,默认的模板后缀为.html。如果是用IntelliJ IDEA工具创建Spring Boot项目，templates文件默认就会创建。</p>
<p>&emsp;当然，如果开发者想对默认的Thymeleaf配置参数进行自定义配置，那么可以直接在application.properties中进行配置，部分常见配置如下:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#是否开启缓存，开发时可设置为false,默认为true</span></span><br><span class="line"><span class="meta">spring.thymeleaf.cache</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#检查模板是否存在，默认为true</span></span><br><span class="line"><span class="meta">spring.thymeleaf.check-template</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#检查模板位置是否存在，默认为true</span></span><br><span class="line"><span class="meta">spring.thymeleaf.check-template-location</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#模板文件编码</span></span><br><span class="line"><span class="meta">spring.thymeleaf.encoding</span>=<span class="string">UTF-8</span></span><br><span class="line"><span class="comment">#模板文件位置</span></span><br><span class="line"><span class="meta">spring.thymeleaf.prefix</span>=<span class="string">classpath:/templates/</span></span><br><span class="line"><span class="comment">#Content-Type配置</span></span><br><span class="line"><span class="meta">spring.thymeleaf.servlet.content-type</span>=<span class="string">text/html</span></span><br><span class="line"><span class="comment">#模板文件后缀</span></span><br><span class="line"><span class="meta">spring.thymeleaf.suffix</span>=<span class="string">.html</span></span><br></pre></td></tr></table></figure>

<p>&emsp;3.配置控制器</p>
<p>&emsp;创建Book实体类，然后再Controller中返回ModelAndView,代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="comment">//省略getter/setter</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookController</span></span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/books"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">books</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;Book&gt; books = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        Book b1 = <span class="keyword">new</span> Book();</span><br><span class="line">        b1.setId(<span class="number">1</span>);</span><br><span class="line">        b1.setAuthor(<span class="string">"罗贯中"</span>);</span><br><span class="line">        b1.setName(<span class="string">"三国演义"</span>);</span><br><span class="line">    	Book b2 = <span class="keyword">new</span> Book();</span><br><span class="line">        b2.setId(<span class="number">2</span>);</span><br><span class="line">        b2.setAuthor(<span class="string">"曹操"</span>);</span><br><span class="line">        b2.setName(<span class="string">"好人妻"</span>);</span><br><span class="line">        books.add(b1);</span><br><span class="line">        books.add(b2);</span><br><span class="line">        ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">"books"</span>,books);</span><br><span class="line">        mv.setViewName(<span class="string">"books"</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码解释:</p>
<p>&emsp;· 创建Book实体类，承载返回数据。</p>
<p>&emsp;· 在BookController中,第11<del>21行构建返回数据，第22</del>25行创建返回ModelAndView,设置视图名为books,返回数据为所创建的List集合。</p>
<p>&emsp;4.创建视图</p>
<p>&emsp;在resources目录下的templates目录中创建books.html,具体代码如下:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>图书列表<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>图书编号<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>图书名称<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>图书作者<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">"book:$&#123;books&#125;"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;book.id&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;book.name&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;book.author&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>代码解释:</p>
<p>&emsp;· 首先在第2行导入Thymeleaf的名称空间</p>
<p>&emsp;· 第14~18行通过遍历将books中的数据展示出来，Thymeleaf中通过th:each进行集合遍历通过th:text展示数据。</p>
<p>&emsp;5.运行</p>
<p>&emsp;在浏览器地址栏中输入”<a href="http://localhost:8080/books&quot;,即可看到运行结果。" target="_blank" rel="noopener">http://localhost:8080/books&quot;,即可看到运行结果。</a></p>
<h2 id="emsp-整合FreeMarker"><a href="#emsp-整合FreeMarker" class="headerlink" title="&emsp;整合FreeMarker"></a>&emsp;整合FreeMarker</h2><p>&emsp;FreeMarker是一个非常古老的模板引擎，可以用在Web环境或者非Web环境中。与Thymeleaf不同，FreeMarker需要经过解析才能够在浏览器中展示出来。FreeMarker不仅可以用来配置HTML页面模板，也可以作为电子邮件模板、配置文件模板以及源码模板等。SpringBoot中对FreeMarker整合也提供了很好的支持，主要整合步骤如下:</p>
<p>&emsp;1.创建项目，添加依赖</p>
<p>&emsp;首先创建springboot项目，然后添加spring-boot-starter-web和spring-boot-starter-freemarker依赖，代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-freemarker&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="emsp-2-配置FreeMarker"><a href="#emsp-2-配置FreeMarker" class="headerlink" title="&emsp;2.配置FreeMarker"></a>&emsp;2.配置FreeMarker</h3><p>&emsp;springBoot对FreeMarker也提供了自动化配置类FreeMarkerAutoConfiguration,相关的配置属性在FreeMarkerProperties中，FreeMarkerProperties部分源码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"spring.freemarker"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FreeMarkerProperties</span> <span class="keyword">extends</span> <span class="title">AbstractTemplateViewResolverProperties</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_TEMPLATE_LOADER_PATH= <span class="string">"classpath:/templates/"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PREFIX=<span class="string">""</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SUFFIX=<span class="string">".ftl"</span>;</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;从改默认配置中可以看到，FreeMarker默认模板位置和ThyMeleaf一样，都在classpath:/templates中，默认文件后缀是.ftl。开发者可以在application.properties中对这些默认配置进行修改，部分常见配置如下:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#HttpServletRequest的属性是否可以覆盖controller中model的同名项</span></span><br><span class="line"><span class="meta">spring.freemarker.allow-request-override</span>=<span class="string">false</span></span><br><span class="line"><span class="comment">#HttpSession的属性是否可以覆盖controller中model的同名项</span></span><br><span class="line"><span class="meta">spring.freemarker.allow-session-override</span>=<span class="string">false</span></span><br><span class="line"><span class="comment">#是否开启缓存</span></span><br><span class="line"><span class="meta">spring.freemarker.cache</span>=<span class="string">false</span></span><br><span class="line"><span class="comment">#模板文件编码</span></span><br><span class="line"><span class="meta">spring.freemarker.charset</span>=<span class="string">UTF-8</span></span><br><span class="line"><span class="comment">#是否检查模板位置</span></span><br><span class="line"><span class="meta">spring.freemarker.check-template-location</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#Content-Type的值</span></span><br><span class="line"><span class="meta">spring.freemarker.context-type</span>=<span class="string">text/html</span></span><br><span class="line"><span class="comment">#是否将HttpServletRequest中的属性添加到Model中</span></span><br><span class="line"><span class="meta">spring.freemarker.expose-request-attributes</span>=<span class="string">false</span></span><br><span class="line"><span class="comment">#模板文件后缀</span></span><br><span class="line"><span class="meta">spring.freemarker.suffix</span>=<span class="string">.ftl</span></span><br><span class="line"><span class="comment">#模板文件位置</span></span><br><span class="line"><span class="meta">spring.freemarker.template-loader-path</span>=<span class="string">classpath:/templates/</span></span><br><span class="line"><span class="comment">#将request对象添加进模板引擎使freemarker能能通过el表达式拿到request对象</span></span><br><span class="line"><span class="meta">spring.freemarker.request-context-attribute</span>=<span class="string">request</span></span><br></pre></td></tr></table></figure>

<p>&emsp;3.配置控制器</p>
<p>&emsp;控制器和Thymeleaf中的控制器一样，这里不再重复。</p>
<p>&emsp;4.创建视图</p>
<p>&emsp;按照配置文件，在resources/templates目录下创建books.ftl文件,内容如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-&#x2F;&#x2F;W3C&#x2F;&#x2F;DTD XHTML 1.0 Transitional&#x2F;&#x2F;EN&quot; &quot;http:&#x2F;&#x2F;www.w3.org&#x2F;TR&#x2F;xhtml1&#x2F;DTD&#x2F;xhtml1-transitional.dtd&quot;&gt;</span><br><span class="line">&lt;html &gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;utf-8&quot; &#x2F;&gt;</span><br><span class="line">    &lt;title&gt;无标题文档&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;a href&#x3D;&quot;$&#123;request.contextPath&#125;&#x2F;jumpadd&quot;&gt;添加图书&lt;&#x2F;a&gt;</span><br><span class="line">&lt;table width&#x3D;&quot;800&quot;&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;名称&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;td&gt;作者&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;td&gt;价格&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;td&gt;出版社&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;td&gt;出版时间&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;td&gt;&amp;nbsp;&lt;&#x2F;td&gt;</span><br><span class="line">    &lt;&#x2F;tr&gt;</span><br><span class="line">    &lt;#list page.list as book&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;$&#123;book.id&#125;&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;book.bookName&#125;&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;book.price&#125;&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;book.author&#125;&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;book.publish&#125;&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;book.publisTime?date&#125;&lt;&#x2F;td&gt;</span><br><span class="line">        &lt;td&gt;</span><br><span class="line">            &lt;a href&#x3D;&quot;$&#123;request.contextPath&#125;&#x2F;jumpadd?id&#x3D;$&#123;book.id&#125;&quot;&gt;修改&lt;&#x2F;a&gt;</span><br><span class="line">            &amp;nbsp;</span><br><span class="line">            &lt;a href&#x3D;&quot;$&#123;request.contextPath&#125;&#x2F;delBook?id&#x3D;$&#123;book.id&#125;&quot;&gt;删除&lt;&#x2F;a&gt;</span><br><span class="line">        &lt;&#x2F;td&gt;</span><br><span class="line">    &lt;&#x2F;tr&gt;</span><br><span class="line">    &lt;&#x2F;#list&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td colspan&#x3D;&quot;6&quot; align&#x3D;&quot;right&quot;&gt;&amp;nbsp;</span><br><span class="line">            &lt;a href&#x3D;&quot;$&#123;request.contextPath&#125;&#x2F;BookAllPage?currPageNo&#x3D;1&#125;&quot;&gt;首页&lt;&#x2F;a&gt; &amp;nbsp;</span><br><span class="line">            &lt;a href&#x3D;&quot;$&#123;request.contextPath&#125;&#x2F;BookAllPage?currPageNo&#x3D;$&#123;page.currPageNo-1&#125;&quot;&gt;上一页&lt;&#x2F;a&gt; &amp;nbsp;</span><br><span class="line">            &lt;a href&#x3D;&quot;$&#123;request.contextPath&#125;&#x2F;BookAllPage?currPageNo&#x3D;$&#123;page.currPageNo+1&#125;&quot;&gt;下一页&lt;&#x2F;a&gt; &amp;nbsp;</span><br><span class="line">            &lt;a href&#x3D;&quot;$&#123;request.contextPath&#125;&#x2F;BookAllPage?currPageNo&#x3D;$&#123;page.totalPageCount&#125;&quot;&gt;尾页&lt;&#x2F;a&gt; &amp;nbsp;</span><br><span class="line">            &amp;nbsp; &amp;nbsp;</span><br><span class="line">        &lt;&#x2F;td&gt;</span><br><span class="line">    &lt;&#x2F;tr&gt;</span><br><span class="line">&lt;&#x2F;table&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>代码解释:</p>
<p>&emsp;· 第14行首先判断model中的books不为空并且books中有数据，然后进行遍历。</p>
<p>&emsp;· 第15~21行表示遍历books集合，将集合中的数据通过表格展示出来。</p>
<p>&emsp;5.运行在浏览器中输入”<a href="http://localhoust:8080/books&quot;,即可看到运行结果。" target="_blank" rel="noopener">http://localhoust:8080/books&quot;,即可看到运行结果。</a></p>
<h3 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h3><p>&emsp;serverTimezone=Asia/Shanghai //这里Asia/Shanghai是url的时区使用中国标准时间  下面的UTC代表的是全球标准时间 </p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.datasource.type</span>=<span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql:///books?serverTimezone=UTC</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>



<h1 id="第四章-SpringBoot整合Web开发"><a href="#第四章-SpringBoot整合Web开发" class="headerlink" title="第四章 SpringBoot整合Web开发"></a>第四章 SpringBoot整合Web开发</h1><h1 id="返回JSON数据"><a href="#返回JSON数据" class="headerlink" title="返回JSON数据"></a>返回JSON数据</h1><h2 id="默认实现"><a href="#默认实现" class="headerlink" title="默认实现"></a>默认实现</h2><p>&emsp;JSON是目前主流的前后端数据传输方式，Spring MVC中使用消息转换器HttpMessageConverter对JSON的转换提供了很好的支持，再SpringBoot中更进一步,对相关配置做了更加一步的简化。默认情况下，当开发者新创建一个SpringBoot项目后，添加Web依赖，代码如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;这个依赖中默认加入了jackson-databind作为JSON处理器，此时步需要添加额外的JSON处理器就能返回一段JSON了。创建一个Book实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String bookName;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> price;</span><br><span class="line">    <span class="meta">@JsonIgnore</span>  <span class="comment">//转换时忽略该属性</span></span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="keyword">private</span> String publish;</span><br><span class="line">    <span class="meta">@DateTimeFormat</span>(pattern = <span class="string">"yyyy-MM-dd"</span>)</span><br><span class="line">    <span class="meta">@JsonFormat</span>(pattern=<span class="string">"yyyy-MM-dd"</span>)</span><br><span class="line">    <span class="keyword">private</span> Date publisTime;</span><br><span class="line">    <span class="comment">//省略getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;然后创建BookController,返回Book对象即可:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@org</span>.springframework.stereotype.Controller</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">     <span class="meta">@GetMapping</span>(<span class="string">"/books"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">books</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;Book&gt; books = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        Book b1 = <span class="keyword">new</span> Book();</span><br><span class="line">        b1.setId(<span class="number">1</span>);</span><br><span class="line">        b1.setAuthor(<span class="string">"罗贯中"</span>);</span><br><span class="line">        b1.setName(<span class="string">"三国演义"</span>);</span><br><span class="line">        Book b2 = <span class="keyword">new</span> Book();</span><br><span class="line">        b2.setId(<span class="number">2</span>);</span><br><span class="line">        b2.setAuthor(<span class="string">"曹操"</span>);</span><br><span class="line">        b2.setName(<span class="string">"好人妻"</span>);</span><br><span class="line">        books.add(b1);</span><br><span class="line">        books.add(b2);</span><br><span class="line">        ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">"books"</span>,books);</span><br><span class="line">        mv.setViewName(<span class="string">"books"</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>//这里@JsonFormat(pattern=”yyyy-MM-dd”)是配合转换器使用的只用返回实体对象的时候才会起作用,返回ModelAndView对象是不会起作用的。</p>
<p>&emsp;当然，如果需要频繁地用到@ResponseBody注解,那么可以采用@RestController组合注解代替@Controller和@ResponseBody,表示标注了该注解的类下的所有方法默认采用@ResponseBody注解方式返回json数据，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">        <span class="meta">@GetMapping</span>(<span class="string">"/books"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">books</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;Book&gt; books = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        Book b1 = <span class="keyword">new</span> Book();</span><br><span class="line">        b1.setId(<span class="number">1</span>);</span><br><span class="line">        b1.setAuthor(<span class="string">"罗贯中"</span>);</span><br><span class="line">        b1.setName(<span class="string">"三国演义"</span>);</span><br><span class="line">        Book b2 = <span class="keyword">new</span> Book();</span><br><span class="line">        b2.setId(<span class="number">2</span>);</span><br><span class="line">        b2.setAuthor(<span class="string">"曹操"</span>);</span><br><span class="line">        b2.setName(<span class="string">"好人妻"</span>);</span><br><span class="line">        books.add(b1);</span><br><span class="line">        books.add(b2);</span><br><span class="line">        ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">"books"</span>,books);</span><br><span class="line">        mv.setViewName(<span class="string">"books"</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;此时，再浏览器中输入”<a href="http://localhost:8080/book&quot;,即可看到返回了JSON数据。" target="_blank" rel="noopener">http://localhost:8080/book&quot;,即可看到返回了JSON数据。</a></p>
<p>&emsp;这是Springboot自带的处理方式。如果采用这种方式，那么对于字段忽略、日期格式化等常见需求都可以通过注解来解决。</p>
<p>&emsp;这是通过Spring中默认提供的MappingJackson2HttpMessageConverter来实现，当然开发者再这里也可以根据实际需求自定义JSON转换器。</p>
<h3 id="Bean-1"><a href="#Bean-1" class="headerlink" title="@Bean"></a>@Bean</h3><p>&emsp;@Bean的id默认为返回该实例的方法的名称。</p>
<h3 id="自定义转换器"><a href="#自定义转换器" class="headerlink" title="自定义转换器"></a>自定义转换器</h3><p>&emsp;常见的JSON处理器除了jackson-databind之外，还有Gson和fastjson,这里针对常见用法分别举例。</p>
<h4 id="emsp-1-使用Gson"><a href="#emsp-1-使用Gson" class="headerlink" title="&emsp;1.使用Gson"></a>&emsp;1.使用Gson</h4><p>&emsp;Gson是Google的一个开源JSON解析框架。使用Gson，需要先除去默认的jackson-databind,然后加入Gson依赖，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;用于SpringBoot中默认提供了Gson的自动转换类GsonHttpMessageConverterConfiguration,因此Gson的依赖添加成功后，可以项使用jackson-databind那样直接使用Gson。但是再Gson进行转换时，如果项对日期数据进行格式化,那么还需要开发者自定义HttpMessageConverter。自定义HttpMessageConverter可以通过如下方式。</p>
<p>&emsp;首先看GsonHttpMessageConvertersConfiguration中的一段源码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="function">GsonHttpMessageConverter <span class="title">gsonHttpMessageConverter</span><span class="params">(Gson gson)</span> </span>&#123;</span><br><span class="line">     GsonHttpMessageConverter converter = <span class="keyword">new</span> GsonHttpMessageConverter();</span><br><span class="line">     converter.setGson(gson);</span><br><span class="line">     <span class="keyword">return</span> converter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;@ConditionalOnMissingBean注解表示当项目中没有提供GsonHttpMessageConverter时才会使用默认的GsonHttpMessageConverter,所以开发者只需要提供一个GsonHttpMessageConverter即可，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"><span class="keyword">import</span> com.google.gson.GsonBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.json.GsonHttpMessageConverter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GsonConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">GsonHttpMessageConverter <span class="title">gsonHttpMessageConverter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        GsonHttpMessageConverter converter = <span class="keyword">new</span> GsonHttpMessageConverter();</span><br><span class="line">        GsonBuilder builder =  <span class="keyword">new</span> GsonBuilder();</span><br><span class="line">        builder.setDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">       chuangj builder.excludeFieldsWithModifiers(Modifier.PROTECTED);<span class="comment">//这里是设置修饰符为protected的字段被过滤掉</span></span><br><span class="line">        Gson gson = builder.create();</span><br><span class="line">        converter.setGson(gson);</span><br><span class="line">       <span class="keyword">return</span> converter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码解释:</p>
<p>· 开发者自己提供一个GsonHttpMessageConverter的实例。</p>
<p>· 设置Gson解析时日期的格式。</p>
<p>· 设置Gson解析时修饰符为protected的字段被过滤掉。</p>
<p>· 创建Gson对象放入GsonHttpMessageConverter的实例中并返回converter。</p>
<h4 id="2-使用fastjson"><a href="#2-使用fastjson" class="headerlink" title="2.使用fastjson"></a>2.使用fastjson</h4><p>&emsp;fastjson是阿里巴巴的一个开源JSON解析框架，是目前JSON解析速度最快的开源框架，该框架也可以集成到Springboot中。不同于Gson,fastjson继承完成之后并不能立马使用，需要开发者提供相应的HttpMessageConverter后才能使用，集成fastjson的步骤如下。</p>
<p>&emsp;首先除去jackson-databind依赖，引入fastjson依赖:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">exclusions</span>&gt;</span><span class="comment">&lt;!--这里是禁用默认的jackson-databind依赖--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;然后配置fastjson的HttpMessageConverter:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.support.config.FastJsonConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFastJsonConfig</span> </span>&#123;  <span class="comment">//Gson和fastjson都配置的情况下优先使用fastjson</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FastJsonHttpMessageConverter <span class="title">fastJsonHttpMessageConverter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        FastJsonHttpMessageConverter converter = <span class="keyword">new</span> FastJsonHttpMessageConverter();</span><br><span class="line">        FastJsonConfig config = <span class="keyword">new</span> FastJsonConfig();</span><br><span class="line">        config.setDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">        config.setCharset(Charset.forName(<span class="string">"UTF-8"</span>));</span><br><span class="line">        config.setSerializerFeatures(</span><br><span class="line">                SerializerFeature.WriteClassName,</span><br><span class="line">                SerializerFeature.WriteMapNullValue,</span><br><span class="line">                SerializerFeature.PrettyFormat,</span><br><span class="line">                SerializerFeature.WriteNullListAsEmpty,</span><br><span class="line">                SerializerFeature.WriteNullStringAsEmpty);</span><br><span class="line">        converter.setFastJsonConfig(config);</span><br><span class="line">        <span class="keyword">return</span> converter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码解释:</p>
<p>· 自定义MyFastJsonConfig，完成对FastJsonHttpMessageConverter Bean的提供。</p>
<p>· 第15~22行分别配置了JSON解析过程的一些细节，例如日期格式、数据编码、是否在生成的JSON中输出类名、是否输出value为null的数据、生成的JSON格式化、空集合输出[]而非null、空字符串输出””而非null等基本配置。</p>
<p>&emsp;MyFastJsonConfig配置完成后，还需要配置以下响应编码，否则返回的JSON中文会乱码，在application.properties中添加如下配置:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#FastJson配置转换器还要配置响应编码不然返回的json会中文乱码</span></span><br><span class="line"><span class="comment">#低版本的springboot项目使用spring.http.encoding.force-response=true //2.1.15的可以使用此配置 2.3.1版本的此配置就淘汰了要使用server.servlet.encoding.force-response=true配置</span></span><br><span class="line"><span class="comment">#spring.http.encoding.force-response=true</span></span><br><span class="line"><span class="meta">server.servlet.encoding.force-response</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>



<p>&emsp;对于FastJsonHttpMessageConverter的配置，除了上面这种方式之外，还有另一种方式。</p>
<p>&emsp;在springBoot项目中，当开发者引入spring-boot-starter-web依赖之后，该依赖又依赖了spring-boot-autoconfigure,在这个自动化配置中，有一个WebMvcAutoConfiguration类提供了对Spring MVC最基本的配置，如果某一项自动化配置不满足开发需求，开发者可以针对该项目自定义配置，只需要实现WebMvcConfigurer接口即可(在spring 5.0之前时通过继承WebMvcConfigurerAdapter类来实现的)，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">        FastJsonHttpMessageConverter converter = <span class="keyword">new</span> FastJsonHttpMessageConverter();</span><br><span class="line">        FastJsonConfig config = <span class="keyword">new</span> FastJsonConfig();</span><br><span class="line">        config.setDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">        config.setCharset(Charset.forName(<span class="string">"UTF-8"</span>));</span><br><span class="line">        config.setSerializerFeatures(</span><br><span class="line">                SerializerFeature.WriteClassName,</span><br><span class="line">                SerializerFeature.WriteMapNullValue,</span><br><span class="line">                SerializerFeature.PrettyFormat,</span><br><span class="line">                SerializerFeature.WriteNullListAsEmpty,</span><br><span class="line">                SerializerFeature.WriteNullStringAsEmpty);</span><br><span class="line">        converter.setFastJsonConfig(config);</span><br><span class="line">        converters.add(converter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码解释:</p>
<p>· 自定义MyWebMvcConfig类并实现WebMvcConfigurer接口中的configureMessageConverters方法。</p>
<p>· 将自定义的FastJsonHttpMessageConverter加入converters中。</p>
<p>//就是说WebMvcAutoConfiguration类提供了最基本的配置，而对于外来导入的依赖也可以根据实现WebMvcConfigurer类重写方法将converter添加进converters集合来添加配置。</p>
<table>
<thead>
<tr>
<th align="center">注意</th>
</tr>
</thead>
<tbody><tr>
<td align="center">如果使用了Gson,也可以采用这种方式配置，但是步推荐。因为当项目中没有GsonHttpMessageConverter时，SpringBoot 自己会提供一个GsonHttpMessageConverter,此时重写configureMessageConverters方法,参数converters中已经有GsonHttpMessageConverter的实例了，需要替换已有的GsonHttpMessageConverter实例，操作比较麻烦，所以对于Gson,推荐直接提供GsonHttpMessageConverter。</td>
</tr>
</tbody></table>
<h2 id="静态资源访问"><a href="#静态资源访问" class="headerlink" title="静态资源访问"></a>静态资源访问</h2><p>&emsp;在SpringBoot中对于静态资源都需要开发者手动配置静态资源过滤。SpringBoot中对此也提供了自动化配置，可以简化静态资源过滤配置。</p>
<h3 id="默认策略"><a href="#默认策略" class="headerlink" title="默认策略"></a>默认策略</h3><p>&emsp;springBoot中对于SpringMVC的自动化配置都在WebMVC的自动化配置都在WebMvcAutoConfigration类中，因此对于默认的静态资源过滤策略可以从这个类中一窥究竟。</p>
<p>&emsp;在WebMvcAutoConfiguration类中有一个静态内部类WebMvcAutoConfigurationAdapter,实现了前面提到的WebMvcConfigurer接口。WebMvcConfigurer接口中有一个方法addResourceHandlers,使用来配置静态资源过滤的。方法在WebMvcAutoConfigurationAdapter类中得到了实现，部分核心代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">        logger.debug(<span class="string">"Default resource handling disabled"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Duration cachePeriod = <span class="keyword">this</span>.resourceProperties.getCache().getPeriod();</span><br><span class="line">        CacheControl cacheControl = <span class="keyword">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();</span><br><span class="line">        <span class="keyword">if</span> (!registry.hasMappingForPattern(<span class="string">"/webjars/**"</span>)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="keyword">new</span> String[]&#123;<span class="string">"/webjars/**"</span>&#125;).addResourceLocations(<span class="keyword">new</span> String[]&#123;<span class="string">"classpath:/META-INF/resources/webjars/"</span>&#125;).setCachePeriod(<span class="keyword">this</span>.getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String staticPathPattern = <span class="keyword">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">        <span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="keyword">new</span> String[]&#123;staticPathPattern&#125;).addResourceLocations(WebMvcAutoConfiguration.getResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations())).setCachePeriod(<span class="keyword">this</span>.getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;springBoot在这里进行了默认的静态资源过滤配置，其中staticPathPattern默认定义WebMvcProperties中，定义内容如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String staticPathPattern=<span class="string">"/**"</span>;</span><br></pre></td></tr></table></figure>

<p>&emsp;this.resourceProperties.getStaticLocations()获取到的默认静态资源位置定义在ResourceProperties中，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS = <span class="keyword">new</span> String[]&#123;<span class="string">"classpath:/META-INF/resources/"</span>, <span class="string">"classpath:/resources/"</span>, <span class="string">"classpath:/static/"</span>, <span class="string">"classpath:/public/"</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>&emsp;在getResourceLocations方法中，对者4个静态资源位置做了扩充，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> String[] getResourceLocations(String[] staticLocations) &#123;</span><br><span class="line">     String[] locations = <span class="keyword">new</span> String[staticLocations.length + SERVLET_LOCATIONS.length];</span><br><span class="line">     System.arraycopy(staticLocations, <span class="number">0</span>, locations, <span class="number">0</span>, staticLocations.length);</span><br><span class="line">     System.arraycopy(SERVLET_LOCATIONS, <span class="number">0</span>, locations, staticLocations.length, SERVLET_LOCATIONS.length);</span><br><span class="line">     <span class="keyword">return</span> locations;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;其中,SERVLET_LOCATIONS的定义是一个{“/“}。</p>
<p>&emsp;综上可以看到,SpringBoot默认会过滤所有的静态资源,而静态资源的位置一共有五个，分被时”classpath:/META-INF/resources/“、”classpath:/resources/“、”classpath:/static/“、”classpath:/public/“以及”/“,也就是说，开发者可以将静态资源放到这5个位置中的任意一个。注意，按照定义的顺序，5个静态资源位置的优先级依次降低。但是一般情况下，SpringBoot项目不需要webapp目录,所以第5个”/“可以暂步考虑。</p>
<p>//优先级就是按上面写过来的顺序依次拿图片”classpath:/META-INF/resources/“路径拿到图片了就不会拿下面同名的图片，如果第一个路径步存在该图片就回去下级路径找，依次类推。</p>
<h3 id="自定义策略"><a href="#自定义策略" class="headerlink" title="自定义策略"></a>自定义策略</h3><p>&emsp;如果默认的静态资源过滤策略不能满足开发需求，也可以自定义静态资源过滤策略，自定义静态资源过滤策略有以下两种方式：</p>
<h6 id="emsp-1-在配置文件中定义"><a href="#emsp-1-在配置文件中定义" class="headerlink" title="&emsp;1.在配置文件中定义"></a>&emsp;1.在配置文件中定义</h6><p>&emsp;可以在application.properties中直接定义过滤规则和静态资源位置，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#指定访问的映射路径</span><br><span class="line">spring.mvc.<span class="keyword">static</span>-path-pattern=/<span class="keyword">static</span><span class="comment">/**</span></span><br><span class="line"><span class="comment">#下面代码会覆盖自动配置默认的4个路径</span></span><br><span class="line"><span class="comment">spring.resources.static-locations=classpath:/static/,classpath:/resources/,classpath:/fff/</span></span><br></pre></td></tr></table></figure>

<p>&emsp;过滤规则为/static/**,静态资源位置为classpath:/static/。</p>
<p>&emsp;重新启动项目，在浏览器中输入”<a href="http://localhost:8080/static/p1.png&quot;,即可看到classpath:/static/目录下的资源。" target="_blank" rel="noopener">http://localhost:8080/static/p1.png&quot;,即可看到classpath:/static/目录下的资源。</a></p>
<h6 id="emsp-emsp-2-Java编码定义"><a href="#emsp-emsp-2-Java编码定义" class="headerlink" title="&emsp;&emsp;2.Java编码定义"></a>&emsp;&emsp;2.Java编码定义</h6><p>&emsp;也可以通过Java编码方式来定义，此时只需要实现WebMvcConfigurer接口即可，然后实现接口的addResourceHandlers方法如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//这里是互补规则 两种方式都会实现都会实现 相当于设置了两种映射规则 即java编码的映射是static/** 则会映射设置的classpath:的几个文件夹 properties配置文件的映射规则访问不到java编码映射规则设置的classpath:路径</span></span><br><span class="line">        registry.addResourceHandler(<span class="string">"/static/**"</span>).addResourceLocations(<span class="string">"classpath:/static/"</span>,<span class="string">"classpath:/cff/"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><p>&emsp;SpringMVC对文件上传做了简化，在springboot中对此做了更进一步的简化，文件上传更为方便。</p>
<p>&emsp;Java中的文件上传一共涉及两个组件，一个是CommonsMultipartResolver,另一个是StandardServletMultipartResolver,其中CommonsMultipartResolver使用commons-fileupload来处理multipart请求,而StandardServletMultipartResolver则是基于Servlet3.0来处理multipart请求的,因此若使用StandardServletMultipartResolver,则步需要添加额外的jar包。Tomcat7.0开始就支持Servlet3.0了,而Springboot2.0.4内嵌的Tomcat为Tomcat8.5.32,因此可以直接使用StandardServletMultipartResolver。而在Spring Boot提供的文件上传自动化配置类MultipartAutoConfiguration中，默认也是采用StandardServletMultipartResolver,部分源码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(</span><br><span class="line">    proxyBeanMethods = <span class="keyword">false</span></span><br><span class="line">)</span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(&#123;Servlet<span class="class">.<span class="keyword">class</span>, <span class="title">StandardServletMultipartResolver</span>.<span class="title">class</span>, <span class="title">MultipartConfigElement</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnProperty</span>(</span></span><br><span class="line"><span class="class">    <span class="title">prefix</span> </span>= <span class="string">"spring.servlet.multipart"</span>,</span><br><span class="line">    name = &#123;<span class="string">"enabled"</span>&#125;,</span><br><span class="line">    matchIfMissing = <span class="keyword">true</span></span><br><span class="line">)</span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span>(</span><br><span class="line">    type = Type.SERVLET</span><br><span class="line">)</span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(&#123;MultipartProperties<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MultipartAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MultipartProperties multipartProperties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MultipartAutoConfiguration</span><span class="params">(MultipartProperties multipartProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.multipartProperties = multipartProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span>(&#123;MultipartConfigElement<span class="class">.<span class="keyword">class</span>, <span class="title">CommonsMultipartResolver</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">MultipartConfigElement</span> <span class="title">multipartConfigElement</span>() </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.multipartProperties.createMultipartConfig();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(</span><br><span class="line">        name = &#123;<span class="string">"multipartResolver"</span>&#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span>(&#123;MultipartResolver<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">StandardServletMultipartResolver</span> <span class="title">multipartResolver</span>() </span>&#123;</span><br><span class="line">        StandardServletMultipartResolver multipartResolver = <span class="keyword">new</span> StandardServletMultipartResolver();</span><br><span class="line">        multipartResolver.setResolveLazily(<span class="keyword">this</span>.multipartProperties.isResolveLazily());</span><br><span class="line">        <span class="keyword">return</span> multipartResolver;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;这里的配置可以看出，如果开发者没有提供MultipartResolver，那么默认采用的MultipartResolver就是StandardServletMultipartResolver。因此，在springboot中上传文件甚至可以做到零配置。</p>
<h3 id="单文件上传"><a href="#单文件上传" class="headerlink" title="单文件上传"></a>单文件上传</h3><p>&emsp;首先创建一个SpringBoot项目并添加spring-boot-starter-web依赖。</p>
<p>&emsp;然后再resources目录下的static目录中创建一个upload.html文件，内容如下:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/chapter02/upload"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"uploadFile"</span> <span class="attr">value</span>=<span class="string">"请选择文件"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"上传"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;这是一个很简单的文件上传页面，上传接口时/upload,注意请求方法时post,enctype是multipart/form-data。</p>
<p>&emsp;接着创建文件上传处理接口，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Controller_upload</span> </span>&#123;</span><br><span class="line">    SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/upload"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(MultipartFile uploadFile, HttpServletRequest request)</span></span>&#123;</span><br><span class="line">        String realPath = request.getSession().getServletContext().getRealPath(<span class="string">"/uploadFile/"</span>); <span class="comment">//获取项目路径下的存放文件目录路径</span></span><br><span class="line">        String format = sdf.format(<span class="keyword">new</span> Date());</span><br><span class="line">        File folder = <span class="keyword">new</span> File(realPath+format);</span><br><span class="line">        <span class="keyword">if</span>(!folder.isDirectory())&#123;</span><br><span class="line">            folder.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        String oldName=uploadFile.getOriginalFilename();</span><br><span class="line">        String newName = UUID.randomUUID().toString()+oldName.substring(oldName.lastIndexOf(<span class="string">"."</span>),oldName.length());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            uploadFile.transferTo(<span class="keyword">new</span> File(folder,newName));</span><br><span class="line">            String filePath=request.getScheme()+<span class="string">"://"</span>+request.getServerName()+<span class="string">":"</span>+request.getServerPort()+<span class="string">"/uploadFile/"</span>+format+newName;</span><br><span class="line">            <span class="keyword">return</span> filePath;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"上传失败！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码解释:</p>
<p>· 第8~13代码表示规划上传文件的保存路径为项目运行目录下的uploadFile文件夹，并在文件夹中通过日期对所上传的文件归类保存。</p>
<p>· 第14~15行代码表示给上传的文件重命名，这是为了避免文件重名。</p>
<p>· 第17行是文件保存操作。</p>
<p>· 第18~19是生成上传文件的访问路径，并将访问路径返回。</p>
<p>&emsp;前面介绍果静态资源位置除了classpath下面的4个路径之外，还有一个”/“，因此这里的图片虽然是静态资源却可以直接访问到。</p>
<p>&emsp;至此一个简单的图片上传逻辑就完成了，对于开发者而言，只需要专注于图片上传的业务逻辑，而不需要在配置上花费太多时间。</p>
<p>&emsp;当然如果开发者需要对图片上传的细节进行配置也是允许的，代码如下:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##上传文件细节配置</span></span><br><span class="line"><span class="comment">#是否开启文件上传支持，默认为true</span></span><br><span class="line"><span class="meta">spring.servlet.multipart.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#文件写入磁盘的阈值，默认为0</span></span><br><span class="line"><span class="meta">spring.servlet.multipart.file-size-threshold</span>=<span class="string">0</span></span><br><span class="line"><span class="comment">#上传文件的临时保存位置</span></span><br><span class="line"><span class="meta">spring.servlet.multipart.location</span>=<span class="string">D:\\tmp</span></span><br><span class="line"><span class="comment">#上传的单个文件的最大大小，默认为1MB -1表示无限制 </span></span><br><span class="line"><span class="comment"># 如果这里设置1MB那么在上传文件的大小超出不能超过太多，超过太多系统会计算不了，//可以理解为在max-file-size设置为1MB系统就会分配一个大于1MB如100MB的最大计算量，</span></span><br><span class="line"><span class="comment"># //超过这个计算量系统就无法计算了，会出现重复调用的异常，最终死掉~</span></span><br><span class="line"><span class="comment">#只能做做小文件上传，一旦文件过大超出限制在全局捕捉异常就会出现异常，无法返回界面，浏览器连接重置</span></span><br><span class="line"><span class="comment"># 可以在拦截器中来抛出超出大小异常，拦截器的弊端就是每次都要把文件完全上传到后端才会去判断是否超出大小，过于费时</span></span><br><span class="line"><span class="meta">spring.servlet.multipart.max-file-size</span>=<span class="string">-1</span></span><br><span class="line"><span class="comment">#多文件上传时文件的总大小，默认为10MB -1表示无限制</span></span><br><span class="line"><span class="meta">spring.servlet.multipart.max-request-size</span>=<span class="string">-1</span></span><br><span class="line"><span class="comment">#文件是否延迟解析，默认为false</span></span><br><span class="line"><span class="meta">spring.servlet.multipart.resolve-lazily</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>

<p>代码解释:</p>
<p>· 第1行表示是否开启文件上传支持，默认为true。</p>
<p>· 第2行表示文件写入磁盘的阈值，默认为0。</p>
<p>· 第3表示上传文件的临时保存位置。</p>
<p>· 第4行表示上传的单个文件的最大大小，默认为1MB。</p>
<p>· 第5行表示多文件上传时文件的总大小，默认为10MB。</p>
<p>· 第6行表示文件是否延迟解析，默认为false。</p>
<p>文件上传超出大小拦截器篇</p>
<p>解决方案: </p>
<p>在properties配置文件设置文件限制大小为无限；这里设置无限了表示每次上传文件都会等文件全部上传完了，才会进入拦截器判断文件大小；此方案太过费时费力，建议用properties配置的方案，由于后端对于超出设置的大小太多的文件，系统无力计算，也可以理解为故意不去计算必经太过费时费力，可以让前端去限制文件最多超出的大小，后端只用在这个限定的超出大小中取一个值来抛出上传限制大小的异常，但是这个值也不能和前端设置的最大值相差太大，并且文件太大的话在超出限制大小后无法在全局捕获异常处正常跳转页面，浏览器连接重置~，只能做做小文件传输。</p>
<p>总结:这里的文件上传也就是传传小文件、并不推荐上传大文件太过影响系统性能。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.servlet.multipart.max-file-size=-<span class="number">1</span></span><br><span class="line">#多文件上传时文件的总大小，默认为10MB -1表示无限制</span><br><span class="line">spring.servlet.multipart.max-request-size=-<span class="number">1</span></span><br></pre></td></tr></table></figure>



<p>在拦截器中配置如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyInterceptor&gt;&gt;&gt;preHandle"</span>);</span><br><span class="line"><span class="comment">//        String token = request.getHeader("token");</span></span><br><span class="line"><span class="comment">//        System.out.println(token);</span></span><br><span class="line">        <span class="keyword">boolean</span> bo=<span class="keyword">true</span>;</span><br><span class="line"><span class="comment">//        if(token.equals("kk"))&#123;    //这里只是测试token的值是否是kk然后写入一句字符串发送给浏览器参考基本的servlet</span></span><br><span class="line"><span class="comment">//            String origin = request.getHeader("Origin");</span></span><br><span class="line"><span class="comment">//            response.setHeader("Access-Control-Allow-Origin", origin);</span></span><br><span class="line"><span class="comment">//            response.setCharacterEncoding("UTF-8");</span></span><br><span class="line"><span class="comment">//            response.setContentType("application/json; charset=utf-8");</span></span><br><span class="line"><span class="comment">//            response.getWriter().write("token通过了但我就是要拦你");</span></span><br><span class="line"><span class="comment">////            response.sendRedirect("http://www.baidu.com");   //这里是重定向的方法 让浏览器重定向到其他页面可以在登录失败时重定向到项目首页</span></span><br><span class="line"><span class="comment">//            bo=false;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//这是配置文件超出大小抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(request!=<span class="keyword">null</span> &amp;&amp; ServletFileUpload.isMultipartContent(request)) &#123;</span><br><span class="line">            ServletRequestContext ctx = <span class="keyword">new</span> ServletRequestContext(request);</span><br><span class="line">            <span class="keyword">long</span> requestSize = ctx.contentLength();</span><br><span class="line">            <span class="keyword">if</span> (requestSize &gt; <span class="number">10485760</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> MaxUploadSizeExceededException(<span class="number">10485760</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bo;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="多文件上传"><a href="#多文件上传" class="headerlink" title="多文件上传"></a>多文件上传</h3><p>&emsp;多文件上传和单文件上传基本一致，首先修改HTML文件，代码如下:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/chapter02/uploads"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"uploadFiles"</span> <span class="attr">value</span>=<span class="string">"请选择文件"</span> <span class="attr">multiple</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"uploadFiles"</span> <span class="attr">value</span>=<span class="string">"请选择文件"</span> <span class="attr">multiple</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"上传"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;然后修改控制器，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/uploads"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">uploads</span><span class="params">(MultipartFile[] uploadFiles, HttpServletRequest request)</span></span>&#123;</span><br><span class="line">    String realPath = request.getSession().getServletContext().getRealPath(<span class="string">"/uploadFile/"</span>); <span class="comment">//获取项目路径下的存放文件目录路径</span></span><br><span class="line">    String format = sdf.format(<span class="keyword">new</span> Date());</span><br><span class="line">    File folder = <span class="keyword">new</span> File(realPath+format);</span><br><span class="line">    <span class="keyword">if</span>(!folder.isDirectory())&#123;</span><br><span class="line">        folder.mkdirs();</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;String&gt; listPath=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(MultipartFile uploadFile:uploadFiles)&#123;</span><br><span class="line">        String oldName=uploadFile.getOriginalFilename();</span><br><span class="line">        String newName = UUID.randomUUID().toString()+oldName.substring(oldName.lastIndexOf(<span class="string">"."</span>),oldName.length());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            uploadFile.transferTo(<span class="keyword">new</span> File(folder,newName));</span><br><span class="line">            String filePath=request.getScheme()+<span class="string">"://"</span>+request.getServerName()+<span class="string">":"</span>+request.getServerPort()+<span class="string">"/uploadFile/"</span>+format+<span class="string">"/"</span>+newName;</span><br><span class="line">            listPath.add(filePath);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            listPath.add(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> listPath;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;控制器里边的核心逻辑和单文件上传是一样的，值时多一个遍历的步骤。</p>
<h2 id="ControllerAdvice"><a href="#ControllerAdvice" class="headerlink" title="@ControllerAdvice"></a>@ControllerAdvice</h2><p>&emsp;顾名思义，@ControllerAdvice就是@Controller的增强版。@ControllerAdvice主要用来处理全局数据，一般搭配@ExceptionHandler、@MdelAttribute以及@InitBinder使用。</p>
<h4 id="全局异常处理"><a href="#全局异常处理" class="headerlink" title="全局异常处理"></a>全局异常处理</h4><p>&emsp;@ControllerAdvice最常见的使用场景就是全局异常处理。在前面介绍果文件上传大小限制的配置，如果用户上传的文件超过了限制大小，就会抛出异常，此时可以通过@ControllerAdvice结合@ExceptionHandler定义全局异常捕获机制，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(MaxUploadSizeExceededException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">uploadException</span>(<span class="title">MaxUploadSizeExceededException</span> <span class="title">e</span>, <span class="title">HttpServletResponse</span> <span class="title">response</span>) <span class="title">throws</span> <span class="title">IOException</span> </span>&#123;</span><br><span class="line">        response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">        System.out.println(<span class="string">"............... uploadException ............... "</span>);</span><br><span class="line">        PrintWriter out = response.getWriter();</span><br><span class="line">        out.write(<span class="string">"上传文件大小超出限制!"</span>);</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;只需在系统中定义CustomExceptionHandler类，然后添加@ControllerAdvice注解即可。当系统启动时，该类就会被扫描到Spring容器中，然后定义uploadException方法，在该方法上添加了@ExceptionHandler注解，其中定义的MaxUploadSizeExceededException.class表明该方法用来处理MaxUploadSizeExceededException改为Exception即可。方法的参数可以有异常实例、HttpServletResponse以及HttpServletRequest、Model等，返回值可以时一段JSON、一个ModelAndView、一个逻辑视图名等。此时，上传一个超大文件还会有错误提示给用户。</p>
<p>&emsp;如果返回参数时一个ModelAndView,假设使用的页面模板为Thymeleaf(注意添加Thymeleaf相关依赖),此时异常处理方法定义如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(MaxUploadSizeExceededException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ModelAndView</span> <span class="title">uploadException</span>(<span class="title">MaxUploadSizeExceededException</span> <span class="title">e</span>, <span class="title">HttpServletResponse</span> <span class="title">response</span>) <span class="title">throws</span> <span class="title">IOException</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"............... uploadException ............... "</span>);</span><br><span class="line">        ModelAndView mo = <span class="keyword">new</span> ModelAndView(<span class="string">"error"</span>);</span><br><span class="line">        mo.addObject(<span class="string">"msg"</span>,<span class="string">"文件超出限制"</span>);</span><br><span class="line">        <span class="keyword">return</span> mo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;然后在resources/templates目录下创建error.html文件，内容如下:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>test<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">"$&#123;msg&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="添加全局数据"><a href="#添加全局数据" class="headerlink" title="添加全局数据"></a>添加全局数据</h4><p>&emsp;@ControllerAdvice是一个全局数据处理组件，因此也可以在@ControllerAdvice中配置全局数据，使用@ModelAttribute注解进行配置，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ModelAttribute</span>(value=<span class="string">"info"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String,String&gt; <span class="title">userInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"username"</span>,<span class="string">"洛罗亚"</span>);</span><br><span class="line">        map.put(<span class="string">"gender"</span>,<span class="string">"男"</span>);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码解释:</p>
<p>· 在全局配置中添加userInfo方法，返回一个map。该方法有一个注解@ModelAttribute，其中的value属性表示这条返回数据的key,而方法的返回值返回数据的value。</p>
<p>· 此时在任意请求的Controller中，通过方法参数中的Model都可以获取info的数据。</p>
<p>· 注意该@ModelAttribute标注的方法要写在标注@ControllerAdvice注解的类中，而且该类中的标注@ExceptionHandler的方法拿不到全局变数据，只能在@Controller中拿。@ModelAttribute在@Controller中时作为给对象赋值使用,也能在@Controller标注的类中里面设置全局数据</p>
<p>&emsp;Controller实例代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/hee"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hee</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">    Map&lt;String,Object&gt; map =model.asMap();</span><br><span class="line">    Set&lt;String&gt; keySet = map.keySet();</span><br><span class="line">    Iterator&lt;String&gt; iterator = keySet.iterator();</span><br><span class="line">    <span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">        String key = iterator.next();</span><br><span class="line">        Object value=map.get(key);</span><br><span class="line">        System.out.println(key+<span class="string">"&gt;&gt;&gt;&gt;&gt;"</span>+value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;进入该请求方法机会把Model中的数据打印出来。</p>
<h4 id="请求参数预处理"><a href="#请求参数预处理" class="headerlink" title="请求参数预处理"></a>请求参数预处理</h4><p>&emsp;@ControllerAdvice结合@InitBinder还能实现请求参数预处理，即将表单中的数据绑定到实体类上时进行一些额外处理。</p>
<p>&emsp;例如有两个实体类Book和Author,代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Author</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Author&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAuthor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> author;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAuthor</span><span class="params">(String author)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.author = author;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Book&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", author='"</span> + author + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;在Controller上需要接收两个实体类的数据，Controller中的方法定义如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/bookAuthor"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">book</span><span class="params">(Book book,Author author)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> book.toString()+<span class="string">"&gt;&gt;&gt;"</span>+author.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;此时在参数传递时，两个实体类中的name属性会混肴，@ControllerAdvice结合@InitBinder可以顺利解决该问题。配置步骤如下。</p>
<p>&emsp;首先给Controller中方法的参数添加@ModelAttribute注解，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/bookAuthor2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">book2</span><span class="params">(@ModelAttribute(<span class="string">"b"</span>)</span> Book book, @<span class="title">ModelAttribute</span><span class="params">(<span class="string">"a"</span>)</span> Author author)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> book.toString()+<span class="string">"&gt;&gt;&gt;"</span>+author.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;然后配置@ControllerAdvice，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@InitBinder</span>(<span class="string">"b"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(WebDataBinder binder)</span></span>&#123;</span><br><span class="line">        binder.setFieldDefaultPrefix(<span class="string">"b."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@InitBinder</span>(<span class="string">"a"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init2</span><span class="params">(WebDataBinder binder)</span></span>&#123;</span><br><span class="line">        binder.setFieldDefaultPrefix(<span class="string">"a."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码解释:</p>
<p>· 在GlobalConfig 类中创建两个方法,第一个@InitBinder(“b”)表示该方法是处理@ModelAttribute(“b”)对应的参数的，第二个@InitBinder(“a”)表示该方法是处理@ModelAttribute(“a”)对应的参数的。</p>
<p>· 在每个方法中给相应的Field设置一个前缀，然后再浏览器中请求<a href="http://localhost:8080/chapter02/bookAuthor2?b.id=1&amp;b.name=g调方&amp;b.author=ddd&amp;a.age=2&amp;a.name=rf,即可成地区分出name属性。" target="_blank" rel="noopener">http://localhost:8080/chapter02/bookAuthor2?b.id=1&amp;b.name=g调方&amp;b.author=ddd&amp;a.age=2&amp;a.name=rf,即可成地区分出name属性。</a></p>
<p>· 再WebDataBinder对象中，还可以设置允许的字段、禁止的字段、必填字段以及验证器等。</p>
<h2 id="自定义错误项"><a href="#自定义错误项" class="headerlink" title="自定义错误项"></a>自定义错误项</h2><p>&emsp;前面介绍了Springboot中的全局异常处理。在处理异常时，开发者可以根据实际情况返回不同的页面，但是这种异常处理方式一般用来处理应用级别的异常，有一些容器级别的错误就处理不了，例如Filter中抛出异常，使用@ControllerAdvice定义的全局异常处理机制就无法处理。因此，springBoot中对于异常的处理还有另外的方式，这就是本次要介绍的内容。</p>
<p>&emsp;在springboot中，默认情况下，如果用户在发起请求时发生了404错误，SpringBoot会有一个默认的页面展示给用户。</p>
<p>&emsp;如果发起请求时发生了500错误，springboot也会有一个默认的页面展示给用户。</p>
<p>&emsp;事实上，springboot在返回错误信息时不一定返回HTML页面，而是根据实际情况返回HTML页面或者一段JSON（若开发者发起Ajax请求，则错误信息时一段JSON）。对于开发者而言，这一段HTML或者JSON都能够自由定制。</p>
<p>&emsp;SpringBoot中的错误默认是由BasicErrorController类来处理，该类中的核心方法主要有两个:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(</span><br><span class="line">    produces = &#123;<span class="string">"text/html"</span>&#125;</span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">errorHtml</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">    HttpStatus status = <span class="keyword">this</span>.getStatus(request);</span><br><span class="line">    Map&lt;String, Object&gt; model = Collections.unmodifiableMap(<span class="keyword">this</span>.getErrorAttributes(request, <span class="keyword">this</span>.getErrorAttributeOptions(request, MediaType.TEXT_HTML)));</span><br><span class="line">    response.setStatus(status.value());</span><br><span class="line">    ModelAndView modelAndView = <span class="keyword">this</span>.resolveErrorView(request, response, status, model);</span><br><span class="line">    <span class="keyword">return</span> modelAndView != <span class="keyword">null</span> ? modelAndView : <span class="keyword">new</span> ModelAndView(<span class="string">"error"</span>, model);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;</span><br><span class="line">    HttpStatus status = <span class="keyword">this</span>.getStatus(request);</span><br><span class="line">    <span class="keyword">if</span> (status == HttpStatus.NO_CONTENT) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity(status);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; body = <span class="keyword">this</span>.getErrorAttributes(request, <span class="keyword">this</span>.getErrorAttributeOptions(request, MediaType.ALL));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity(body, status);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;其中，errorHtml方法用来返回错误HTML页面，error用来返回错误JSON，具体返回的是HTML还是JSON，则要看请求头的Accept参数。返回JSON的逻辑很简单，不必过多介绍，返回HTML的逻辑稍微有些复杂，在errorHtml方法中，通过调用resolveErrorView方法来获取一个错误视图的ModelAndView。而resolveErrorView方法的调用最终会来到DefaultErrorViewResolver类中。</p>
<p>&emsp;DefaultErrorViewResolver类是SpringBoot中默认的错误信息视图解析器，部分源码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultErrorViewResolver</span> <span class="keyword">implements</span> <span class="title">ErrorViewResolver</span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Series, String&gt; SERIES_VIEWS;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        Map&lt;Series, String&gt; views = <span class="keyword">new</span> EnumMap(Series<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        views.put(Series.CLIENT_ERROR, <span class="string">"4xx"</span>);</span><br><span class="line">        views.put(Series.SERVER_ERROR, <span class="string">"5xx"</span>);</span><br><span class="line">        SERIES_VIEWS = Collections.unmodifiableMap(views);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line">        <span class="function"><span class="keyword">private</span> ModelAndView <span class="title">resolve</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">        String errorViewName = <span class="string">"error/"</span> + viewName;</span><br><span class="line">        TemplateAvailabilityProvider provider = <span class="keyword">this</span>.templateAvailabilityProviders.getProvider(errorViewName, <span class="keyword">this</span>.applicationContext);</span><br><span class="line">        <span class="keyword">return</span> provider != <span class="keyword">null</span> ? <span class="keyword">new</span> ModelAndView(errorViewName, model) : <span class="keyword">this</span>.resolveResource(errorViewName, model);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;从这一段源码中可以看到，SpringBoot默认实在error目录下查找4xx、5xx的文件作为错误视图，当找不到时会回到errorHtml方法中，然后使用error作为默认的错误页面视图名，如果名为error的视图也找不到，用户就会看到springboot提供的默认错误提示页面。整个错误处理流程大致就是这样的。</p>
<h3 id="简单配置"><a href="#简单配置" class="headerlink" title="简单配置"></a>简单配置</h3><p>&emsp;通过上面的介绍自定义错误页面其实很简单，提供4xx、5xx页面即可。如果开发者不需要项用户展示详细的错误信息，那么可以把错误信息定义成静态页面，直接在resources/static目录下创建error目录，然后再error目录中创建错误展示页面。错误展示页面的命名规则有两种：一种是4xx.html、5xx.html;另一种是直接使用响应码命名文件，例如404.html、405.html、500.html.第二种命名方式划分得更细，当出错时，不同的错误会展示不同的错误页面。</p>
<p>&emsp;当用户访问一个不存在的路径时，就会展示404.html页面中的内容。</p>
<p>&emsp;这种定义都是使用了静态HTML页面，无法向用户展示完整的错误信息，若采用视图模板技术，则可以向用户展示更多的错误信息。如果要使用HTML模板，那么先引入模板相关的依赖，这里以Thymeleaf为例，Thymeleaf页面模板默认处于classpath:/templates/目录下，因此再该目录下先创建error目录，再创建错误展示页。</p>
<p>&emsp;由于模板页面展示信息比较灵活，因此可以直接创建4xx.htm、5xx.html。以4xx.html页面为例，其内容如下:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span> xmlns:th=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=utf-8"</span> /&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;table border=<span class="string">"1"</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;timestamp&lt;/td&gt;</span><br><span class="line">        &lt;td th:text="$&#123;timestamp&#125;"&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;status&lt;/td&gt;</span><br><span class="line">        &lt;td th:text="$&#123;status&#125;"&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;error&lt;/td&gt;</span><br><span class="line">        &lt;td th:text="$&#123;error&#125;"&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;message&lt;/td&gt;</span><br><span class="line">        &lt;td th:text="$&#123;message&#125;"&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;path&lt;/td&gt;</span><br><span class="line">        &lt;td th:text="$&#123;path&#125;"&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#表示在错误提示中始终提供message的信息展示 加了可以在自定义错误页面获取到message</span></span><br><span class="line"><span class="meta">server.error.include-message</span>=<span class="string">always</span></span><br></pre></td></tr></table></figure>

<p>&emsp;springboot2.3.1版本要在properties文件加上面这句，才能拿到message信息。</p>
<p>&emsp;SpringBoot再这里一共返回了5条错误相关的信息，分别时timestamp、status、error、message</p>
<p>以及path。5xx.html页面的内容于4xx.html页面的内容一致。</p>
<p>&emsp;此时，用户访问一个不存在的地址，4xx.html页面中的内容将被展示出来。</p>
<p><strong>&emsp;若用户定义了多个错误页面，则响应码.html页面的优先级高于4xx.html、5xx.html页面的优先级，即若当前时一个404错误，则优先展示404.html而不是4xxhtml;动态页面的优先级高于静态页面，即若resources/tempplates和resources/static下同时定义了4xx.html,则优先展示resources/templates/4xx.html，前提是4xx.html是在error目录下，不然系统会找不到4xx.html或404.html，找不到的情况下系统会在resources下找error.html，都找不到的话会使用系统默认的界面。</strong></p>
<h3 id="复杂配置"><a href="#复杂配置" class="headerlink" title="复杂配置"></a>复杂配置</h3><p>&emsp;上面这种配置还是不够灵活，只能定义HTML页面，无法处理JSON的定制。springBoot中支持对Error信息的深度定制，接下来将从三个方面介绍深度定制:自定义Error视图以及完全自定义。</p>
<h4 id="emsp-1-自定义Error数据"><a href="#emsp-1-自定义Error数据" class="headerlink" title="&emsp;1.自定义Error数据"></a>&emsp;1.自定义Error数据</h4><p>&emsp;自定义Error数据就是对返回的数据进行自定义。经前面介绍，已经了解到springboot返回的Error信息一共有5条，分别是timestamp、status、error、message已经path。在BasicErrorController的errorHtml方法和error方法中，都是通过getErrorAttributes方法，而DefaultErrorAttributes类是在ErrorMvcAutoConfiguration中默认提供的。ErrorMvcAutoConfiguration类的errorAttributes方法源码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(</span><br><span class="line">    value = &#123;ErrorAttributes<span class="class">.<span class="keyword">class</span>&#125;,</span></span><br><span class="line"><span class="class">    <span class="title">search</span> </span>= SearchStrategy.CURRENT</span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">public</span> DefaultErrorAttributes <span class="title">errorAttributes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DefaultErrorAttributes();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;从这段原码中可以看出，当系统没有提供ErrorAttributes时才会采用DefaultErrorAttributes。因此自定义错误提示时，只需要自己提供一个ErrorAttributes即可，而DefaultErrorAttributes是ErrorAttributes的子类，因此只需要继承DefaultErrorAttributes即可，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyErrorAttribute</span> <span class="keyword">extends</span> <span class="title">DefaultErrorAttributes</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(WebRequest webRequest, ErrorAttributeOptions options)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; errorAttributes= <span class="keyword">super</span>.getErrorAttributes(webRequest, options);</span><br><span class="line">        errorAttributes.put(<span class="string">"custommsg"</span>,<span class="string">"出错了才怪~"</span>);</span><br><span class="line">        errorAttributes.remove(<span class="string">"error"</span>); <span class="comment">//移除error信息</span></span><br><span class="line">        <span class="keyword">return</span> errorAttributes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码解释:</p>
<ul>
<li>自定义MyErrorAttribute继承自DefaultErrorAttributes,重写DefaultErrorAttributes中的getErrorAttributes方法。MyErrorAttribute类添加@Component注解，该类将被注册到Spring容器中。</li>
<li>第5行通过super.getErrorAttributes获取springboot默认提供的错误信息，然后在此基础上添加Error信息或者移除Error信息。 </li>
</ul>
<p>&emsp;此时，当系统抛出异常时，错误信息将被修改，error拿不到信息添加custommsg属性再访问不存在的路径可以看到自定义的错误信息，并且可以看到默认的error被移除了。</p>
<p>&emsp;如果通过Postman等工具来发起这个请求，那么返回的JSON数据中也是如此。</p>
<h4 id="2-自定义Error视图"><a href="#2-自定义Error视图" class="headerlink" title="2.自定义Error视图"></a>2.自定义Error视图</h4><p>&emsp;Error视图是展示给用户的页面，再BasicErrorCOntroller得errorHtml方法中调用resolverErrorView方法获取一个ModelAndView实例。resolveErrorView方法是由ErrorViewResolver提供得，通过ErrorMvcAutoConfiguration类得源码可以看到SpringBoot默认采用得ErrorViewResolver是DefaultErrorViewResolver。ErrorMvcAutoConfiguration部分源码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnBean</span>(&#123;DispatcherServlet<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnMissingBean</span>(</span>&#123;ErrorViewResolver<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">DefaultErrorViewResolver</span> <span class="title">conventionErrorViewResolver</span>() </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DefaultErrorViewResolver(<span class="keyword">this</span>.applicationContext, <span class="keyword">this</span>.resourceProperties);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;从这一段源码可以看到，如果用户没有定义ErrorViewResolver,那么默认使用得ErrorViewResolver是DefaultErrorViewResolver,正是在DefaultErrorViewResolver中配置了默认去error目录下寻找4xx.html、5xx.html。因此，开发者想要自定义Error视图，只需要提供自己的ErrorViewResolver即可,代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyErrorViewResolver</span> <span class="keyword">implements</span> <span class="title">ErrorViewResolver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpStatus status, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">        ModelAndView mv = <span class="keyword">new</span> ModelAndView(<span class="string">"errorPage"</span>);</span><br><span class="line">        mv.addObject(<span class="string">"custommsg"</span>,<span class="string">"出错了才有鬼~"</span>);</span><br><span class="line">        mv.addAllObjects(model);   <span class="comment">//这里是把model中的键值对填充进mv.</span></span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码解释:</p>
<ul>
<li>自定义MyErrorViewResolver实现ErrorViewResolver接口并实现接口中的resolveErrorView方法，使用@Component注解将该类注册到Spring容器中。</li>
<li>在resolverErrorView方法中，最后一个Map参数就是SpringBoot提供的默认的5条Error信息(可以按照前面自定义Error数据的步骤对者5条信息进行修改).在resolveErrorView方法中，返回一个ModelAndView,在ModelAndView中设置Error视图和Error数据。</li>
<li>理论上，开发者也可以通过实现ErrorViewResolver接口来实现Error数据的自定义，但是如果值时单纯地想自定义Error数据，还是建议继承DefaultErrorAttributes。</li>
</ul>
<p>&emsp;在errorPage.html中，除了展示springboot提供的5条Error信息外，也展示了开发者自定义的Error信息。此时，无论请求发生4xx的错误还是发生5xx的错误，都会来到errorPage.html页面。</p>
<h4 id="3-完全自定义"><a href="#3-完全自定义" class="headerlink" title="3.完全自定义"></a>3.完全自定义</h4><p>&emsp;前面提到的两种自定义方式都是对BasicErrorController类中的某个环节进行修补。查看Error自动化配置类ERrorMvcAutoConfiguration,可以发现BasicErrorCOntroller本身只是一个默认的配置，相关源码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorMvcAutoConfiguration</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span>(</span><br><span class="line">        value = &#123;ErrorController<span class="class">.<span class="keyword">class</span>&#125;,</span></span><br><span class="line"><span class="class">        <span class="title">search</span> </span>= SearchStrategy.CURRENT</span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> BasicErrorController <span class="title">basicErrorController</span><span class="params">(ErrorAttributes errorAttributes, ObjectProvider&lt;ErrorViewResolver&gt; errorViewResolvers)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BasicErrorController(errorAttributes, <span class="keyword">this</span>.serverProperties.getError(), (List)errorViewResolvers.orderedStream().collect(Collectors.toList()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;从这段源码可以看到，若开发者没有提供自己的ErrorController,则</p>
<p>SpringBoot提供BasicErrorController作为默认的ERrorController。因此，如果开发者需要更加灵活地对Error视图和数据进行处理，那么只需要提供自己地ErrorCOntroller即可。提供自己地ErrorController有两种方式：一种是实现ErrorController接口，另一种是直接继承BasicErrorController。由于ErrorController接口只提供一个待实现地方法，而BasicErrorController已经实现了很多功能，因此这里选择第二种方式，即通过继承BasicErrorController来实现自己地ErrorController。具体定义如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyErrorController</span> <span class="keyword">extends</span> <span class="title">BasicErrorController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyErrorController</span><span class="params">(ErrorAttributes errorAttributes, ServerProperties serverProperties, List&lt;ErrorViewResolver&gt; errorViewResolvers)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(errorAttributes, serverProperties.getError(), errorViewResolvers);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">errorHtml</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        HttpStatus status = getStatus(request);</span><br><span class="line">        Map&lt;String,Object&gt; model= getErrorAttributes(request,<span class="keyword">this</span>.getErrorAttributeOptions(request, MediaType.TEXT_HTML));</span><br><span class="line">        model.put(<span class="string">"custommsg"</span>,<span class="string">"出错了emmmm"</span>);</span><br><span class="line">        ModelAndView modelAndView = <span class="keyword">new</span> ModelAndView(<span class="string">"myErrorPage"</span>,model,status);</span><br><span class="line">        <span class="keyword">return</span> modelAndView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;</span><br><span class="line">        Map&lt;String,Object&gt; body = getErrorAttributes(request,<span class="keyword">this</span>.getErrorAttributeOptions(request,MediaType.TEXT_HTML));</span><br><span class="line">        body.put(<span class="string">"custommsg"</span>,<span class="string">"出错了json"</span>);</span><br><span class="line">        HttpStatus status = getStatus(request);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(body,status);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;</p>
<p>代码解释:</p>
<ul>
<li><p>自定义MyErrorController继承自BasicErrorController并添加@Controller注解，将MyErrorController注册到SpringMVC容器中。</p>
</li>
<li><p>由于BasicErrorController没有无参构造方法，因此在创建BasicErrorController实例时需要</p>
</li>
<li><p>传递参数，在MyErrorController地构造方法上添加@Autowired注解注入所需参数。</p>
</li>
<li><p>参考BasicErrorController中的实现，重写errorHtml和error方法，对Error的视图和数据进行充分的自定义。</p>
</li>
</ul>
<h2 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h2><p>&emsp;同源策略是由Netscape提出的一个著名的安全策略,他是浏览器最核心也最基本的安全功能，限制所有支持JavaScript的浏览器都会是用这个策略。所谓同源是指协议、域名以及端口要相同。同源策略是基于安全方面的考虑提出来的，这个策略本身没问题，但是我们在实际开发中，由于各种原因又经常有跨域的需求，传统的跨域方案是JSONP,JSONP虽然能解决跨域但是又一个很大的局限性，那就是只支持GET请求，不支持其他类型的请求，而今天我们说的CORS(跨域源资源共享)(CORS,Cross-Origin Resource Sharing)是一个W3C标准，它是一份浏览器技术的规范，提供了Web服务从不同网域传来沙盒脚本的方法，以避开浏览器的同源策略，这是JSONP模式的现代版。</p>
<h2 id="CORS支持"><a href="#CORS支持" class="headerlink" title="CORS支持"></a>CORS支持</h2><p>&emsp;CORS(Cross-Origin Resource Sharing)是由W3C制定的一种跨域资源共享技术标准，其目的就是为了解决前端的跨域请求。在JavaEE开发中，最常见的前端跨域请求解决方案是JSONP，但JSONP只支持GET请求，这是一个很大的缺陷，而CORS则支持多种HTTP请求方法。以CORS中的GET请求为例，当浏览器发起请求时，请求投中携带了如下信息:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">...</span><br><span class="line">Host:localhost:8080</span><br><span class="line">Origin:http://localhost:8081</span><br><span class="line">Referer:http://localhost:8081/index.html</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>&emsp;假如服务端支持CORS,则服务端给出相应信息如下:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">...</span><br><span class="line">Access-Control-Allow-Origin:http://localhost:8081</span><br><span class="line">Content-Length:20</span><br><span class="line">Content-Type:text/plain;charset=UTF-8</span><br><span class="line">Date:Thu, 12 Jul 2018 12:51:14</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">注意</th>
</tr>
</thead>
<tbody><tr>
<td align="center">响应头中有一个Access-Control-Allow-Origin字段，用来记录可以访问该资源的域。当浏览器收到这样的响应头信息之后，提取出Access-Control-Allow-Origin字段中的值，发现该值包含当前页面所在的域，就知道这个跨域时被允许的，因此就不再对前端的跨域请求进行限制。这就是GET请求的整个跨域流程，在这个过程中，前端请求的代码不需要修改，主要是后端进行处理。这个流程主要是针对GET、POST、以及HEAD请求，并且没有自定义请求头，如果用户发起一个DELETE请求、PUT请求或者自定义了请求头，流程就会稍微复杂一些。</td>
</tr>
</tbody></table>
<p>&emsp;以DELETE请求为例，当前端发起一个DELETE请求时，这个请求的处理会经过两个步骤。</p>
<p>&emsp;第一步：发送一个OPTIONS请求。代码如下:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">...</span><br><span class="line">Access-Control-Request-Method DELETE</span><br><span class="line">Connection keep-alive</span><br><span class="line">Host localhost:8080</span><br><span class="line">Origin http://localhost:8081</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>&emsp;这个请求将向服务端询问是否具备该资源的DELETE权限，服务端会给浏览器一个相应，代码如下:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">...</span><br><span class="line">HTTP/1.1 200</span><br><span class="line">Access-Control-Allow-Origin: http://localhost:8081</span><br><span class="line">Access-Control-Allow-Methods: DELETE</span><br><span class="line">Access-Control-Max-Age: 1800</span><br><span class="line">Allow: GET, HEAD, POST, PUT, DELETE, OPTIONS, PATCH</span><br><span class="line">Control-Length: 0</span><br><span class="line">Date: Thu, 12 Jul 2018 13:20:26 GMT</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>服务端给浏览器的响应，Allow头信息表示服务端支持的请求方法，这个请求相当于一个探测请求，当浏览器分析了请求头字段之后，知道服务端支持本次请求，则进入第二步。</p>
<p>&emsp;第二步:发送DELETE请求。接下来浏览器就会发送一个跨域的DELETE请求，代码如下:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">...</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Origin: http://localhost:8081</span><br><span class="line">Connection: keep-alive</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>&emsp;服务端给一个响应:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">...</span><br><span class="line">HTTP/1.1 200</span><br><span class="line">Access-Control-Allow-Origin: http://localhost:8081</span><br><span class="line">Content-Type: text/plain;cahrset=UTF-8</span><br><span class="line">Date:Thu, Jul 2018 13:20:26 GMT</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>&emsp;至此，一个跨于的DELETE请求完成。</p>
<p>&emsp;无论时简单请求还是需要先进行探测的请求，前端的写法都是不变的，额外的处理都是在服务端来完成的。在传统的Java EE开发中，可以通过过滤器同意配置，而SpringBoot中对此则提供了更加简介的解决方案。在springboot中配置CORS的步骤如下:</p>
<h4 id="emsp-1-创建SpringBoot工程"><a href="#emsp-1-创建SpringBoot工程" class="headerlink" title="&emsp;1.创建SpringBoot工程"></a>&emsp;1.创建SpringBoot工程</h4><p>&emsp;首先创建一个springboot工程，添加Web依赖，代码如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="emsp-2-创建控制器"><a href="#emsp-2-创建控制器" class="headerlink" title="&emsp;2.创建控制器"></a>&emsp;2.创建控制器</h4><p>&emsp;在新创建的SpringBoot工程中，添加一个BookController控制器，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@org</span>.springframework.stereotype.Controller</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hellp</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"helloword3"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;3.配置跨域</p>
<p>&emsp;跨域又两个地方可以配置。一个时直接在相应的请求方法上加注解，这里使用在类上加注解表示应用所有方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@org</span>.springframework.stereotype.Controller</span><br><span class="line"><span class="comment">//maxAge表示探测请求有效期，在有效期内不用重复发探测请求 allowedHeaders表示允许所有请求头通过 *是表达式</span></span><br><span class="line"><span class="comment">// origins表示能通过的源 *表示所有 在不写origins时可以设置value写法如：value = "http://localhost:8081"</span></span><br><span class="line"><span class="comment">//methods表示允许通过的请求方法要使用里面的枚举类</span></span><br><span class="line"><span class="meta">@CrossOrigin</span>(maxAge = <span class="number">30</span>*<span class="number">60</span>,allowedHeaders = <span class="string">"*"</span>,allowCredentials = <span class="string">"true"</span>,origins = <span class="string">"*"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hellp</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"helloword3"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>代码解释:</p>
<ul>
<li>@CrossOrigin中的value表示支持的域，这里表示来自<a href="http://localhost:8081域的请求时支持跨域的。@CrossOrigin可以写类上表示类中所有方法都应用该注解;写在方法上表示该方法应用该注解。" target="_blank" rel="noopener">http://localhost:8081域的请求时支持跨域的。@CrossOrigin可以写类上表示类中所有方法都应用该注解;写在方法上表示该方法应用该注解。</a></li>
<li>maxAge表示探测请求的有效期，对于DELETE、PUT请求或者自定义头信息的请求,在执行过程中会先发送探测请求，探测请求不用每次都发送，可以配置一个有效期，有效期过了之后才会发送探测请求。这个属性默认时1800秒，即30分钟。探测请求就是每次发送上面说的三个复杂请求时都会先发一个探测请求去后端服务器验证然后返回结果给前端浏览器，在浏览器调试窗口发送PUT请求时可以看到Request Method: OPTIONS ，OPTIONS 就是探测请求的名称。</li>
<li>allowedHeaders表示允许的请求头，*表示所有的请求头都被允许。</li>
</ul>
<p>&emsp;这种配置方式时一种细粒度的配置，可以控制到每一个方法上。当然，也可以不在每个方法上添加@CrossOrigin注解，而是采用一种全局配置,代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//这里@CrossOrigin的参数是数组 在这配置和在注解配置的参数都会添加进数组里面 它们两个设置的参数都会存在，都能用到~</span></span><br><span class="line">        <span class="comment">//allowedMethods()默认支持GET、POST和HEAD 注解或配置一旦设置默认的就被覆盖了</span></span><br><span class="line">        registry.addMapping(<span class="string">"/**"</span>)</span><br><span class="line">                .allowedHeaders(<span class="string">"*"</span>)</span><br><span class="line">                .allowedMethods(<span class="string">"*"</span>)</span><br><span class="line">                .maxAge(<span class="number">60</span>*<span class="number">30</span>)</span><br><span class="line">                .allowedOrigins(<span class="string">"http://localhost:8081"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码解释：</p>
<ul>
<li>全局配置需要自定义类实现WebMvcConfigurer接口，然后实现接口中的addCorsMappings方法。</li>
<li>在addCorsMappings方法中，addMapping表示对那种格式的请求路径进行跨域处理；allowedHeaders表示须臾的请求头，默认允许所有的请求头信息;allowedMethods表示允许的请求方法，默认的GET、POST和HEAD；*表示支持所有的请求方法；maxAge表示探测请求的有效期;allowedOrigins表示支持的域。</li>
</ul>
<p>&emsp;4.测试</p>
<p>&emsp;新建一个springboot项目，添加Web依赖，然后再resources/static目录下加入jquery.js,再在resources/static目录下创建一个index.html，内容如下:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"jquery-1.12.4.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"idd"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"put"</span> <span class="attr">value</span>=<span class="string">"PUT"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> &gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#idd"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            $.post(<span class="string">"http://localhost:8080/chapter02/hello"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line">                alert(data);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="javascript">        $(<span class="string">"#put"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            $.ajax(&#123;</span></span><br><span class="line"><span class="actionscript">                url: <span class="string">"http://localhost:8080/chapter02/hello"</span>,</span></span><br><span class="line"><span class="actionscript">                type: <span class="string">"PUT"</span>,</span></span><br><span class="line"><span class="actionscript">                success: <span class="function"><span class="keyword">function</span><span class="params">(html)</span></span>&#123;</span></span><br><span class="line">                    alert(html);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;两个普通的Ajax都发送了一个跨域请求。</p>
<p>&emsp;然后将项目的端口修改为8081,代码如下:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8081</span></span><br></pre></td></tr></table></figure>

<p>&emsp;实际效果自己实验<del>~</del></p>
<h2 id="配置类与XML配置"><a href="#配置类与XML配置" class="headerlink" title="配置类与XML配置"></a>配置类与XML配置</h2><p>&emsp;springboot推荐使用Java来完成相关的配置工作。在项目中，不建议将所有的配置放在一个配置类中，可以根据不同的需求提供不同的配置类，例如专门处理springSecurity的配置类、提供Bean的配置类、SpringMVC相关的配置类。这些配置类上都需要添加@Configuration注解，@ComponentScan注解会扫描所有spring组件，也包括@Configuration。@ComponentScan注解项目入口类的@SpringBootApplication注解中已经提供，因此在实际项目中只需要按需提供相关配置类即可。</p>
<p>&emsp;springboot中并不推荐使用XML配置，建议尽量用Java配置代替XML配置，如果开发者需要使用XML配置，只需在resources目录下提供配置文件，然后通过@ImportResource加载配置文件即可。例如，有一个Hello类如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello"</span>+name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;在resources目录下新建beans.xml文件配置该类:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"hello"</span> <span class="attr">class</span>=<span class="string">"com.example.demo.Bean.Hello"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;然后创建Beans配置类，导入XML配置:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ImportResource</span>(<span class="string">"classpath:templates/error/beans.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Beans</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;最后在Controller中就可以直接导入Hello类使用了:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@org</span>.springframework.stereotype.Controller</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Hello hello;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hellp</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"helloword3"</span>+hello.sayHello(<span class="string">"山上有风景"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="注册拦截器"><a href="#注册拦截器" class="headerlink" title="注册拦截器"></a>注册拦截器</h2><p>&emsp;springMVC中提供了AOP风格的拦截器，拥有更加精细的拦截处理能力。springBoot中拦截器的注册更加方便，步骤如下:</p>
<p>&emsp;1.创建一个springboot项目，添加spring-boot-starter-web依赖。</p>
<p>&emsp;2.创建拦截器实现HandlerInterceptor接口，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyInterceptor&gt;&gt;&gt;preHandle"</span>);</span><br><span class="line">        String token = request.getHeader(<span class="string">"token"</span>);</span><br><span class="line">        System.out.println(token);</span><br><span class="line">        Boolean bo=<span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(token.equals(<span class="string">"kk"</span>))&#123;    <span class="comment">//这里只是测试token的值是否是kk然后写入一句字符串发送给浏览器参考基本的servlet</span></span><br><span class="line">            String origin = request.getHeader(<span class="string">"Origin"</span>);</span><br><span class="line">            response.setHeader(<span class="string">"Access-Control-Allow-Origin"</span>, origin);</span><br><span class="line">            response.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">            response.setContentType(<span class="string">"application/json; charset=utf-8"</span>);</span><br><span class="line">            response.getWriter().write(<span class="string">"token通过了但我就是要拦你"</span>);</span><br><span class="line"><span class="comment">//            response.sendRedirect("http://www.baidu.com");   //这里是重定向的方法 让浏览器重定向到其他页面可以在登录失败时重定向到项目首页</span></span><br><span class="line">            bo=<span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bo;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyInterceptor&gt;&gt;&gt;postHandle"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyInterceptor&gt;&gt;&gt;afterCompletion"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;拦截器中的方法将按preHandle→Controller→postHandle→afterCompletion的顺序执行。注意，只有preHandle方法返回true时后面的方法才会执行。当拦截器链内存在多个拦截器时，postHandler在拦截器链内的所有拦截器返回成功时才会调用，而afterCompletion只有preHandle返回true才调用，但若拦截器链内的第一个拦截器的preHandle方法返回false,则后面的方法都不会执行。</p>
<p>&emsp;3.配置拦截器。定义配置类进行蓝机器的配置，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//addInterceptor(new MyInterceptor())中的new MyInterceptor()是自己创建的拦截类 addPathPatterns表示拦截路径，excludePathPatterns表示排除的路径。</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> MyInterceptor())</span><br><span class="line">                .addPathPatterns(<span class="string">"/**"</span>)</span><br><span class="line">                .excludePathPatterns(<span class="string">"/hello"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;自定义类实现WebMvcConfigurer接口，实现接口中的addInterceptors方法。其中，addPathPatterns表示拦截路径，excludePathPatterns表示排除的路径。</p>
<h2 id="启动系统任务"><a href="#启动系统任务" class="headerlink" title="启动系统任务"></a>启动系统任务</h2><p>&emsp;有一些特殊的任务需要在系统启动时执行，例如配置文件加载，数据库初始化等操作。如果没有使用Springboot,这些问题可以在Listener中解决。springboot对此提供了两种解决方案:CommandLineRunner和ApplicationRunner。CommandLineRunner和ApplicationRunner基本一致,差别主要体现在参数上。</p>
<h3 id="CommandLineRunner"><a href="#CommandLineRunner" class="headerlink" title="CommandLineRunner"></a>CommandLineRunner</h3><p>&emsp;springBoot项目在启动时会遍历所有CommandLineRunner的实现类并调用其中的run方法，如果整个系统中有多个CommandLineRunner的实现类,那么可以使用@Order注解对这些实现类的调用顺序进行排序。</p>
<p>&emsp;在一个SpringBoot Web项目中添加两个CommandLineRunner，分别如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">我想要个红包</div><div id="qr" style="display:none;"><div style="display:inline-block"><a href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/alipay-qrcode.jpg" target="_blank" rel="noopener"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/alipay-qrcode.jpg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/qqpay-qrcode.png" target="_blank" rel="noopener"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/qqpay-qrcode.png" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/wechatpay-qrcode.jpg" target="_blank" rel="noopener"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/wechatpay-qrcode.jpg" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>John Doe</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://1090266178.github.io/2020/07/01/SpringBoot/" title="SpringBoot">https://1090266178.github.io/2020/07/01/SpringBoot/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2020/07/02/MAVEN/" rel="prev" title="MAVEN"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">MAVEN</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2020/07/01/helloword/" rel="next" title="Hello World"><span class="post-nav-text">Hello World</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div id="comment"><div class="comment-tooltip text-center"><span>点击按钮跳转 GitHub Issues 评论。</span><br><span>若没有本文 Issue，您可以使用 Comment 模版新建。</span><br><a class="hty-button hty-button--raised" id="github-issues" href="https://github.com/YunYouJun/yunyoujun.github.io/issues?q=is:issue+SpringBoot" target="_blank" rel="noopener">GitHub Issues</a></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2020 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> John Doe</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v4.2.1</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v0.9.1</span></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div><script defer src="/js/utils.js"></script><script defer src="/js/hexo-theme-yun.js"></script></body></html>